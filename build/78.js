"use strict";(self.webpackChunkrrze_video=self.webpackChunkrrze_video||[]).push([[78],{3908:(e,t,s)=>{s.d(t,{k:()=>i});const i={setAuto:Symbol(0),enableAuto:Symbol(0)}},2445:(e,t,s)=>{s.d(t,{Hp:()=>n,_k:()=>h,to:()=>o});var i=s(9873),a=s(8350),r=s(9777);const n={crossOrigin:Symbol(0),readyState:Symbol(0),updateActiveCues:Symbol(0),canLoad:Symbol(0),onModeChange:Symbol(0),native:Symbol(0),nativeHLS:Symbol(0)};class o extends i.zv{static createId(e){return`vds-${e.type}-${e.kind}-${e.src??e.label??"?"}`}src;content;type;encoding;id="";label="";language="";kind;default=!1;#e=!1;#t=0;#s="disabled";#i={};#a=[];#r=[];#n=[];[n.readyState]=0;[n.crossOrigin];[n.onModeChange]=null;[n.native]=null;get metadata(){return this.#i}get regions(){return this.#a}get cues(){return this.#r}get activeCues(){return this.#n}get readyState(){return this[n.readyState]}get mode(){return this.#s}set mode(e){this.setMode(e)}constructor(e){super();for(const t of Object.keys(e))this[t]=e[t];this.type||(this.type="vtt"),e.content?this.#o(e):e.src||(this[n.readyState]=2)}addCue(e,t){let s=0,a=this.#r.length;for(s=0;s<a&&!(e.endTime<=this.#r[s].startTime);s++);s===a?this.#r.push(e):this.#r.splice(s,0,e),e instanceof TextTrackCue||this[n.native]?.track.addCue(e),this.dispatchEvent(new i.vP("add-cue",{detail:e,trigger:t})),(0,r.Yc)(e,this.#t)&&this[n.updateActiveCues](this.#t,t)}removeCue(e,t){const s=this.#r.indexOf(e);if(s>=0){const a=this.#n.includes(e);this.#r.splice(s,1),this[n.native]?.track.removeCue(e),this.dispatchEvent(new i.vP("remove-cue",{detail:e,trigger:t})),a&&this[n.updateActiveCues](this.#t,t)}}setMode(e,t){this.#s!==e&&(this.#s=e,"disabled"===e?(this.#n=[],this.#d()):2===this.readyState?this[n.updateActiveCues](this.#t,t):this.#h(),this.dispatchEvent(new i.vP("mode-change",{detail:this,trigger:t})),this[n.onModeChange]?.())}[n.updateActiveCues](e,t){if(this.#t=e,"disabled"===this.mode||!this.#r.length)return;const s=[];for(let t=0,i=this.#r.length;t<i;t++){const i=this.#r[t];(0,r.Yc)(i,e)&&s.push(i)}let i=s.length!==this.#n.length;if(!i)for(let e=0;e<s.length;e++)if(!this.#n.includes(s[e])){i=!0;break}this.#n=s,i&&this.#d(t)}[n.canLoad](){this.#e=!0,"disabled"!==this.#s&&this.#h()}#o(e){s.e(124).then(s.bind(s,7124)).then((({parseText:t,VTTCue:s,VTTRegion:a})=>{(0,i.Kg)(e.content)&&"json"!==e.type?t(e.content,{type:e.type}).then((({cues:e,regions:t})=>{this.#r=e,this.#a=t,this.#c()})):(this.#l(e.content,s,a),3!==this.readyState&&this.#c())}))}async#h(){if(this.#e&&!(this[n.readyState]>0))if(this[n.readyState]=1,this.dispatchEvent(new i.vP("load-start")),this.src)try{const{parseResponse:e,VTTCue:t,VTTRegion:i}=await s.e(124).then(s.bind(s,7124)),r=this[n.crossOrigin]?.(),o=fetch(this.src,{headers:"json"===this.type?{"Content-Type":"application/json"}:void 0,credentials:(0,a.WF)(r)});if("json"===this.type)this.#l(await(await o).text(),t,i);else{const{errors:t,metadata:s,regions:i,cues:a}=await e(o,{type:this.type,encoding:this.encoding});if(0===t[0]?.code)throw t[0];this.#i=s,this.#a=i,this.#r=a}this.#c()}catch(e){this.#u(e)}else this.#c()}#c(){if(this[n.readyState]=2,!this.src||"vtt"!==this.type){const e=this[n.native];if(e&&!e.managed)for(const t of this.#r)e.track.addCue(t)}const e=new i.vP("load");this[n.updateActiveCues](this.#t,e),this.dispatchEvent(e)}#u(e){this[n.readyState]=3,this.dispatchEvent(new i.vP("error",{detail:e}))}#l(e,t,s){try{const{regions:a,cues:r}=function(e,t,s){const a=(0,i.Kg)(e)?JSON.parse(e):e;let r=[],n=[];return a.regions&&s&&(r=a.regions.map((e=>Object.assign(new s,e)))),(a.cues||(0,i.cy)(a))&&(n=((0,i.cy)(a)?a:a.cues).filter((e=>(0,i.Et)(e.startTime)&&(0,i.Et)(e.endTime))).map((e=>Object.assign(new t(0,0,""),e)))),{regions:r,cues:n}}(e,t,s);this.#a=a,this.#r=r}catch(e){this.#u(e)}}#d(e){this.dispatchEvent(new i.vP("cue-change",{trigger:e}))}}const d=/captions|subtitles/;function h(e){return d.test(e.kind)}},589:(e,t,s)=>{s.d(t,{Ap:()=>r,BE:()=>n,JG:()=>o,zJ:()=>a});var i=s(9873);class a{#p;get length(){return this.#p.length}constructor(e,t){(0,i.cy)(e)?this.#p=e:(0,i.b0)(e)||(0,i.b0)(t)?this.#p=[]:this.#p=[[e,t]]}start(e){return this.#p[e][0]??1/0}end(e){return this.#p[e][1]??1/0}}function r(e){if(!e.length)return null;let t=e.start(0);for(let s=1;s<e.length;s++){const i=e.start(s);i<t&&(t=i)}return t}function n(e){if(!e.length)return null;let t=e.end(0);for(let s=1;s<e.length;s++){const i=e.end(s);i>t&&(t=i)}return t}function o(e,t,s){let i=t[0],a=t[1];return s<i?[s,-1]:s===i?t:-1===i?(t[0]=s,t):(s>i&&(t[1]=s,-1===a&&e.push(t)),function(e){if(e.length<=1)return e;e.sort(((e,t)=>e[0]-t[0]));let t=[],s=e[0];for(let i=1;i<e.length;i++){const a=e[i];s[1]>=a[0]-1?s=[s[0],Math.max(s[1],a[1])]:(t.push(s),s=a)}t.push(s)}(e),t)}},5760:(e,t,s)=>{function i(e){return e instanceof Error?e:Error("string"==typeof e?e:JSON.stringify(e))}function a(e,t){if(!e)throw Error("Assertion failed.")}s.d(t,{r:()=>i,v:()=>a})},7636:(e,t,s)=>{s.d(t,{j:()=>i});const i={add:Symbol(0),remove:Symbol(0),reset:Symbol(0),select:Symbol(0),readonly:Symbol(0),setReadonly:Symbol(0),onReset:Symbol(0),onRemove:Symbol(0),onUserSelect:Symbol(0)}},3801:(e,t,s)=>{s.d(t,{O:()=>a,f:()=>r});var i=s(9873);let a=(0,i.O)(!1);(0,i.k6)(document,"pointerdown",(()=>{a.set(!1)})),(0,i.k6)(document,"keydown",(e=>{e.metaKey||e.altKey||e.ctrlKey||a.set(!0)}));class r extends i.WO{#g=(0,i.O)(!1);onConnect(e){(0,i.QZ)((()=>{const t=new i.En(e);if(!a())return this.#g.set(!1),n(e,!1),void t.add("pointerenter",this.#m.bind(this)).add("pointerleave",this.#y.bind(this));const s=document.activeElement===e;this.#g.set(s),n(e,s),t.add("focus",this.#v.bind(this)).add("blur",this.#f.bind(this))}))}focused(){return this.#g()}#v(){this.#g.set(!0),n(this.el,!0)}#f(){this.#g.set(!1),n(this.el,!1)}#m(){o(this.el,!0)}#y(){o(this.el,!1)}}function n(e,t){(0,i.Bq)(e,"data-focus",t),(0,i.Bq)(e,"data-hocus",t)}function o(e,t){(0,i.Bq)(e,"data-hocus",t),(0,i.Bq)(e,"data-hover",t)}},2344:(e,t,s)=>{function i(e,t=2){return Number(e.toFixed(t))}function a(e){return String(e).split(".")[1]?.length??0}function r(e,t,s){return Math.max(e,Math.min(s,t))}s.d(t,{LI:()=>i,N:()=>r,Q4:()=>a})},9078:(e,t,s)=>{var i=s(9873),a=s(6455),r=s(9934),n=s(589),o=s(2445),d=s(7636),h=s(3908),c=s(5760),l=s(8350),u=s(1192),p=s(2344),g=s(3801);class m extends i.zv{items=[];[d.j.readonly]=!1;get length(){return this.items.length}get readonly(){return this[d.j.readonly]}indexOf(e){return this.items.indexOf(e)}getById(e){return""===e?null:this.items.find((t=>t.id===e))??null}toArray(){return[...this.items]}[Symbol.iterator](){return this.items.values()}[d.j.add](e,t){const s=this.items.length;""+s in this||Object.defineProperty(this,s,{get(){return this.items[s]}}),this.items.includes(e)||(this.items.push(e),this.dispatchEvent(new i.vP("add",{detail:e,trigger:t})))}[d.j.remove](e,t){const s=this.items.indexOf(e);s>=0&&(this[d.j.onRemove]?.(e,t),this.items.splice(s,1),this.dispatchEvent(new i.vP("remove",{detail:e,trigger:t})))}[d.j.reset](e){for(const t of[...this.items])this[d.j.remove](t,e);this.items=[],this[d.j.setReadonly](!1,e),this[d.j.onReset]?.()}[d.j.setReadonly](e,t){this[d.j.readonly]!==e&&(this[d.j.readonly]=e,this.dispatchEvent(new i.vP("readonly-change",{detail:e,trigger:t})))}}const y=i.jv.fullscreenEnabled;class v extends i.WO{#k=!1;#w=!1;get active(){return this.#w}get supported(){return y}onConnect(){new i.En(i.jv).add("fullscreenchange",this.#b.bind(this)).add("fullscreenerror",this.#q.bind(this)),(0,i.zp)(this.#T.bind(this))}async#T(){y&&await this.exit()}#b(e){const t=f(this.el);t!==this.#w&&(t||(this.#k=!1),this.#w=t,this.dispatch("fullscreen-change",{detail:t,trigger:e}))}#q(e){this.#k&&(this.dispatch("fullscreen-error",{detail:null,trigger:e}),this.#k=!1)}async enter(){try{if(this.#k=!0,!this.el||f(this.el))return;return k(),i.jv.requestFullscreen(this.el)}catch(e){throw this.#k=!1,e}}async exit(){if(this.el&&f(this.el))return k(),i.jv.exitFullscreen()}}function f(e){if(i.jv.fullscreenElement===e)return!0;try{return e.matches(i.jv.fullscreenPseudoClass)}catch(e){return!1}}function k(){if(!y)throw Error("[vidstack] no fullscreen API")}class w extends i.WO{#P=(0,i.O)(this.#$());#E=(0,i.O)(!1);#S;get type(){return this.#P()}get locked(){return this.#E()}get portrait(){return this.#P().startsWith("portrait")}get landscape(){return this.#P().startsWith("landscape")}static supported=(0,r.E7)();get supported(){return w.supported}onConnect(){if(this.supported)(0,i.k6)(screen.orientation,"change",this.#C.bind(this));else{const e=window.matchMedia("(orientation: landscape)");e.onchange=this.#C.bind(this),(0,i.zp)((()=>e.onchange=null))}(0,i.zp)(this.#T.bind(this))}async#T(){this.supported&&this.#E()&&await this.unlock()}#C(e){this.#P.set(this.#$()),this.dispatch("orientation-change",{detail:{orientation:(0,i.se)(this.#P),lock:this.#S},trigger:e})}async lock(e){(0,i.se)(this.#E)||this.#S===e||(this.#L(),await screen.orientation.lock(e),this.#E.set(!0),this.#S=e)}async unlock(){(0,i.se)(this.#E)&&(this.#L(),this.#S=void 0,await screen.orientation.unlock(),this.#E.set(!1))}#L(){if(!this.supported)throw Error("[vidstack] no orientation API")}#$(){return this.supported?window.screen.orientation.type:window.innerWidth>=window.innerHeight?"landscape-primary":"portrait-primary"}}function b(e){return!(0,i.Kg)(e)&&"width"in e&&"height"in e&&(0,i.Et)(e.width)&&(0,i.Et)(e.height)}const q=new i.Uw({artist:"",artwork:null,audioTrack:null,audioTracks:[],autoPlay:!1,autoPlayError:null,audioGain:null,buffered:new n.zJ,canLoad:!1,canLoadPoster:!1,canFullscreen:!1,canOrientScreen:(0,r.E7)(),canPictureInPicture:!1,canPlay:!1,clipStartTime:0,clipEndTime:0,controls:!1,get iOSControls(){return r.dh&&"video"===this.mediaType&&(!this.playsInline||!i.jv.fullscreenEnabled&&this.fullscreen)},get nativeControls(){return this.controls||this.iOSControls},controlsVisible:!1,get controlsHidden(){return!this.controlsVisible},crossOrigin:null,ended:!1,error:null,fullscreen:!1,get loop(){return this.providedLoop||this.userPrefersLoop},logLevel:"silent",mediaType:"unknown",muted:!1,paused:!0,played:new n.zJ,playing:!1,playsInline:!1,pictureInPicture:!1,preload:"metadata",playbackRate:1,qualities:[],quality:null,autoQuality:!1,canSetQuality:!0,canSetPlaybackRate:!0,canSetVolume:!1,canSetAudioGain:!1,seekable:new n.zJ,seeking:!1,source:{src:"",type:""},sources:[],started:!1,textTracks:[],textTrack:null,get hasCaptions(){return this.textTracks.filter(o._k).length>0},volume:1,waiting:!1,realCurrentTime:0,get currentTime(){return this.ended?this.duration:this.clipStartTime>0?Math.max(0,Math.min(this.realCurrentTime-this.clipStartTime,this.duration)):this.realCurrentTime},providedDuration:-1,intrinsicDuration:0,get realDuration(){return this.providedDuration>0?this.providedDuration:this.intrinsicDuration},get duration(){return this.clipEndTime>0?this.clipEndTime-this.clipStartTime:Math.max(0,this.realDuration-this.clipStartTime)},get title(){return this.providedTitle||this.inferredTitle},get poster(){return this.providedPoster||this.inferredPoster},get viewType(){return"unknown"!==this.providedViewType?this.providedViewType:this.inferredViewType},get streamType(){return"unknown"!==this.providedStreamType?this.providedStreamType:this.inferredStreamType},get currentSrc(){return this.source},get bufferedStart(){const e=(0,n.Ap)(this.buffered)??0;return Math.max(0,e-this.clipStartTime)},get bufferedEnd(){const e=(0,n.BE)(this.buffered)??0;return Math.min(this.duration,Math.max(0,e-this.clipStartTime))},get seekableStart(){const e=(0,n.Ap)(this.seekable)??0;return Math.max(0,Math.abs(e-this.clipStartTime))},get seekableEnd(){const e=this.canPlay?(0,n.BE)(this.seekable)??1/0:0;return this.clipEndTime>0?Math.max(this.clipEndTime,Math.max(0,e-this.clipStartTime)):e},get seekableWindow(){return Math.max(0,this.seekableEnd-this.seekableStart)},canAirPlay:!1,canGoogleCast:!1,remotePlaybackState:"disconnected",remotePlaybackType:"none",remotePlaybackLoader:null,remotePlaybackInfo:null,get isAirPlayConnected(){return"airplay"===this.remotePlaybackType&&"connected"===this.remotePlaybackState},get isGoogleCastConnected(){return"google-cast"===this.remotePlaybackType&&"connected"===this.remotePlaybackState},pointer:"fine",orientation:"landscape",width:0,height:0,mediaWidth:0,mediaHeight:0,lastKeyboardAction:null,userBehindLiveEdge:!1,liveEdgeTolerance:10,minLiveDVRWindow:60,get canSeek(){return/unknown|on-demand|:dvr/.test(this.streamType)&&Number.isFinite(this.seekableWindow)&&(!this.live||/:dvr/.test(this.streamType)&&this.seekableWindow>=this.minLiveDVRWindow)},get live(){return this.streamType.includes("live")||!Number.isFinite(this.realDuration)},get liveEdgeStart(){return this.live&&Number.isFinite(this.seekableEnd)?Math.max(0,(this.liveSyncPosition??this.seekableEnd)-this.liveEdgeTolerance):0},get liveEdge(){return this.live&&(!this.canSeek||!this.userBehindLiveEdge&&this.currentTime>=this.liveEdgeStart)},get liveEdgeWindow(){return this.live&&Number.isFinite(this.seekableEnd)?this.seekableEnd-this.liveEdgeStart:0},autoPlaying:!1,providedTitle:"",inferredTitle:"",providedLoop:!1,userPrefersLoop:!1,providedPoster:"",inferredPoster:"",inferredViewType:"unknown",providedViewType:"unknown",providedStreamType:"unknown",inferredStreamType:"unknown",liveSyncPosition:null,savedState:null}),T=new Set(["autoPlayError","autoPlaying","buffered","canPlay","error","paused","played","playing","seekable","seeking","waiting"]),P=new Set([...T,"ended","inferredPoster","inferredStreamType","inferredTitle","intrinsicDuration","liveSyncPosition","realCurrentTime","savedState","started","userBehindLiveEdge"]);function $(e,t=!1){const s=t?T:P;q.reset(e,(e=>s.has(e))),(0,i.io)()}class E{#I=null;#M=null;#R=-1;#x;constructor(e=void 0){this.#x=e}setTarget(e){this.#I=e}getPlayer(e){return this.#M||(e??this.#I)?.dispatchEvent(new i.vP("find-media-player",{detail:e=>{this.#M=e},bubbles:!0,composed:!0})),this.#M}setPlayer(e){this.#M=e}startLoading(e){this.#A("media-start-loading",e)}startLoadingPoster(e){this.#A("media-poster-start-loading",e)}requestAirPlay(e){this.#A("media-airplay-request",e)}requestGoogleCast(e){this.#A("media-google-cast-request",e)}play(e){this.#A("media-play-request",e)}pause(e){this.#A("media-pause-request",e)}mute(e){this.#A("media-mute-request",e)}unmute(e){this.#A("media-unmute-request",e)}enterFullscreen(e,t){this.#A("media-enter-fullscreen-request",t,e)}exitFullscreen(e,t){this.#A("media-exit-fullscreen-request",t,e)}lockScreenOrientation(e,t){this.#A("media-orientation-lock-request",t,e)}unlockScreenOrientation(e){this.#A("media-orientation-unlock-request",e)}enterPictureInPicture(e){this.#A("media-enter-pip-request",e)}exitPictureInPicture(e){this.#A("media-exit-pip-request",e)}seeking(e,t){this.#A("media-seeking-request",t,e)}seek(e,t){this.#A("media-seek-request",t,e)}seekToLiveEdge(e){this.#A("media-live-edge-request",e)}changeDuration(e,t){this.#A("media-duration-change-request",t,e)}changeClipStart(e,t){this.#A("media-clip-start-change-request",t,e)}changeClipEnd(e,t){this.#A("media-clip-end-change-request",t,e)}changeVolume(e,t){this.#A("media-volume-change-request",t,Math.max(0,Math.min(1,e)))}changeAudioTrack(e,t){this.#A("media-audio-track-change-request",t,e)}changeQuality(e,t){this.#A("media-quality-change-request",t,e)}requestAutoQuality(e){this.changeQuality(-1,e)}changeTextTrackMode(e,t,s){this.#A("media-text-track-change-request",s,{index:e,mode:t})}changePlaybackRate(e,t){this.#A("media-rate-change-request",t,e)}changeAudioGain(e,t){this.#A("media-audio-gain-change-request",t,e)}resumeControls(e){this.#A("media-resume-controls-request",e)}pauseControls(e){this.#A("media-pause-controls-request",e)}togglePaused(e){const t=this.getPlayer(e?.target);t&&(t.state.paused?this.play(e):this.pause(e))}toggleControls(e){const t=this.getPlayer(e?.target);t&&(t.controls.showing?t.controls.hide(0,e):t.controls.show(0,e))}toggleMuted(e){const t=this.getPlayer(e?.target);t&&(t.state.muted?this.unmute(e):this.mute(e))}toggleFullscreen(e,t){const s=this.getPlayer(t?.target);s&&(s.state.fullscreen?this.exitFullscreen(e,t):this.enterFullscreen(e,t))}togglePictureInPicture(e){const t=this.getPlayer(e?.target);t&&(t.state.pictureInPicture?this.exitPictureInPicture(e):this.enterPictureInPicture(e))}showCaptions(e){const t=this.getPlayer(e?.target);if(!t)return;let s=t.state.textTracks,i=this.#R;s[i]&&(0,o._k)(s[i])||(i=-1),-1===i&&(i=s.findIndex((e=>(0,o._k)(e)&&e.default))),-1===i&&(i=s.findIndex((e=>(0,o._k)(e)))),i>=0&&this.changeTextTrackMode(i,"showing",e),this.#R=-1}disableCaptions(e){const t=this.getPlayer(e?.target);if(!t)return;const s=t.state.textTracks,i=t.state.textTrack;if(i){const t=s.indexOf(i);this.changeTextTrackMode(t,"disabled",e),this.#R=t}}toggleCaptions(e){const t=this.getPlayer(e?.target);t&&(t.state.textTrack?this.disableCaptions():this.showCaptions())}userPrefersLoopChange(e,t){this.#A("media-user-loop-change-request",t,e)}#A(e,t,s){const a=new i.vP(e,{bubbles:!0,composed:!0,cancelable:!0,detail:s,trigger:t});let r=t?.target||null;r&&r instanceof i.uA&&(r=r.el);const n=!r||r===document||r===window||r===document.body||this.#M?.el&&r instanceof Node&&!this.#M.el.contains(r);r=n?this.#I??this.getPlayer()?.el:r??this.#I,this.#M&&("media-play-request"!==e||this.#M.state.canLoad)?this.#M.canPlayQueue.enqueue(e,(()=>r?.dispatchEvent(a))):r?.dispatchEvent(a)}#O(e){}}class S{playerId="vds-player";mediaId=null;#Q={volume:null,muted:null,audioGain:null,time:null,lang:null,captions:null,rate:null,quality:null};async getVolume(){return this.#Q.volume}async setVolume(e){this.#Q.volume=e,this.save()}async getMuted(){return this.#Q.muted}async setMuted(e){this.#Q.muted=e,this.save()}async getTime(){return this.#Q.time}async setTime(e,t){const s=e<0;this.#Q.time=s?null:e,s||t?this.saveTime():this.saveTimeThrottled()}async getLang(){return this.#Q.lang}async setLang(e){this.#Q.lang=e,this.save()}async getCaptions(){return this.#Q.captions}async setCaptions(e){this.#Q.captions=e,this.save()}async getPlaybackRate(){return this.#Q.rate}async setPlaybackRate(e){this.#Q.rate=e,this.save()}async getAudioGain(){return this.#Q.audioGain}async setAudioGain(e){this.#Q.audioGain=e,this.save()}async getVideoQuality(){return this.#Q.quality}async setVideoQuality(e){this.#Q.quality=e,this.save()}onChange(e,t,s="vds-player"){const i=s?localStorage.getItem(s):null,a=t?localStorage.getItem(t):null;this.playerId=s,this.mediaId=t,this.#Q={volume:null,muted:null,audioGain:null,lang:null,captions:null,rate:null,quality:null,...i?JSON.parse(i):{},time:a?+a:null}}save(){if(!this.playerId)return;const e=JSON.stringify({...this.#Q,time:void 0});localStorage.setItem(this.playerId,e)}saveTimeThrottled=(0,i.z3)(this.saveTime.bind(this),1e3);saveTime(){if(!this.mediaId)return;const e=(this.#Q.time??0).toString();localStorage.setItem(this.mediaId,e)}}class C{priority=0;#D=!0;#F=null;#V=null;#j=new Set;canRender(e,t){return!!t}attach(e){this.#F=e,e&&(e.textTracks.onchange=this.#b.bind(this))}addTrack(e){this.#j.add(e),this.#z(e)}removeTrack(e){e[o.Hp.native]?.remove?.(),e[o.Hp.native]=null,this.#j.delete(e)}changeTrack(e){const t=e?.[o.Hp.native];t&&"showing"!==t.track.mode&&(t.track.mode="showing"),this.#V=e}setDisplay(e){this.#D=e,this.#b()}detach(){this.#F&&(this.#F.textTracks.onchange=null);for(const e of this.#j)this.removeTrack(e);this.#j.clear(),this.#F=null,this.#V=null}#z(e){if(!this.#F)return;const t=e[o.Hp.native]??=this.#K(e);(0,u.sb)(t)&&(this.#F.append(t),t.track.mode=t.default?"showing":"disabled")}#K(e){const t=document.createElement("track"),s=e.default||"showing"===e.mode,i=e.src&&"vtt"===e.type;return t.id=e.id,t.src=i?e.src:"",t.label=e.label,t.kind=e.kind,t.default=s,e.language&&(t.srclang=e.language),s&&!i&&this.#N(e,t.track),t}#N(e,t){if(!(e.src&&"vtt"===e.type||t.cues?.length))for(const s of e.cues)t.addCue(s)}#b(e){for(const t of this.#j){const s=t[o.Hp.native];if(!s)continue;if(!this.#D){s.track.mode=s.managed?"hidden":"disabled";continue}const i="showing"===s.track.mode;i&&this.#N(t,s.track),t.setMode(i?"showing":"disabled",e)}}}class L{#F=null;#W;#G=[];#Z;#U=!1;#B=null;#H=null;constructor(e){this.#Z=e;const t=e.textTracks;this.#W=t,(0,i.QZ)(this.#_.bind(this)),(0,i.zp)(this.#J.bind(this)),new i.En(t).add("add",this.#X.bind(this)).add("remove",this.#Y.bind(this)).add("mode-change",this.#ee.bind(this))}#_(){const{nativeControls:e}=this.#Z.$state;this.#U=e(),this.#ee()}add(e){this.#G.push(e),(0,i.vz)(this.#ee.bind(this))}remove(e){e.detach(),this.#G.splice(this.#G.indexOf(e),1),(0,i.vz)(this.#ee.bind(this))}attachVideo(e){requestAnimationFrame((()=>{if(this.#F=e,e){this.#B=new C,this.#B.attach(e);for(const e of this.#W)this.#te(e)}this.#ee()}))}#te(e){(0,o._k)(e)&&this.#B?.addTrack(e)}#se(e){(0,o._k)(e)&&this.#B?.removeTrack(e)}#X(e){this.#te(e.detail)}#Y(e){this.#se(e.detail)}#ee(){const e=this.#W.selected;if(this.#F&&(this.#U||e?.[o.Hp.nativeHLS]))return this.#H?.changeTrack(null),this.#B?.setDisplay(!0),void this.#B?.changeTrack(e);if(this.#B?.setDisplay(!1),this.#B?.changeTrack(null),!e)return void this.#H?.changeTrack(null);const t=this.#G.sort(((e,t)=>e.priority-t.priority)).find((t=>t.canRender(e,this.#F)));this.#H!==t&&(this.#H?.detach(),t?.attach(this.#F),this.#H=t??null),t?.changeTrack(e)}#J(){this.#B?.detach(),this.#B=null,this.#H?.detach(),this.#H=null}}class I extends m{#e=!1;#ie={};#ae=null;#re=null;[o.Hp.crossOrigin];constructor(){super()}get selected(){return this.items.find((e=>"showing"===e.mode&&(0,o._k)(e)))??null}get selectedIndex(){const e=this.selected;return e?this.indexOf(e):-1}get preferredLang(){return this.#re}set preferredLang(e){this.#re=e,this.#ne(e)}add(e,t){const s=e instanceof o.to?e:new o.to(e),i="captions"===e.kind||"subtitles"===e.kind?"captions":e.kind;return this.#ie[i]&&e.default&&delete e.default,s.addEventListener("mode-change",this.#oe),this[d.j.add](s,t),s[o.Hp.crossOrigin]=this[o.Hp.crossOrigin],this.#e&&s[o.Hp.canLoad](),e.default&&(this.#ie[i]=s),this.#de(),this}remove(e,t){if(this.#he=e,this.items.includes(e))return e===this.#ie[e.kind]&&delete this.#ie[e.kind],e.mode="disabled",e[o.Hp.onModeChange]=null,e.removeEventListener("mode-change",this.#oe),this[d.j.remove](e,t),this.#he=null,this}clear(e){for(const t of[...this.items])this.remove(t,e);return this}getByKind(e){const t=Array.isArray(e)?e:[e];return this.items.filter((e=>t.includes(e.kind)))}[o.Hp.canLoad](){if(!this.#e){for(const e of this.items)e[o.Hp.canLoad]();this.#e=!0,this.#de()}}#de=(0,i.IO)((async()=>{if(!this.#e)return;!this.#re&&this.#ae&&(this.#re=await this.#ae.getLang());const e=await(this.#ae?.getCaptions()),t=[["captions","subtitles"],"chapters","descriptions","metadata"];for(const s of t){const t=this.getByKind(s);if(t.find((e=>"showing"===e.mode)))continue;const a=this.#re?t.find((e=>e.language===this.#re)):null,r=(0,i.cy)(s)?this.#ie[s.find((e=>this.#ie[e]))||""]:this.#ie[s],n=a??r,d=n&&(0,o._k)(n);!n||d&&!1===e||(n.mode="showing",d&&this.#ce(n))}}),300);#he=null;#oe=this.#le.bind(this);#le(e){const t=e.detail;if(this.#ae&&(0,o._k)(t)&&t!==this.#he&&this.#ce(t),"showing"===t.mode){const e=(0,o._k)(t)?["captions","subtitles"]:[t.kind];for(const s of this.items)"showing"===s.mode&&s!=t&&e.includes(s.kind)&&(s.mode="disabled")}this.dispatchEvent(new i.vP("mode-change",{detail:e.detail,trigger:e}))}#ce(e){"disabled"!==e.mode&&this.#ne(e.language),this.#ae?.setCaptions?.("showing"===e.mode)}#ne(e){this.#ae?.setLang?.(this.#re=e)}setStorage(e){this.#ae=e}}const M=Symbol(0);class R extends m{get selected(){return this.items.find((e=>e.selected))??null}get selectedIndex(){return this.items.findIndex((e=>e.selected))}[d.j.onRemove](e,t){this[d.j.select](e,!1,t)}[d.j.add](e,t){e[M]=!1,Object.defineProperty(e,"selected",{get(){return this[M]},set:t=>{this.readonly||(this[d.j.onUserSelect]?.(),this[d.j.select](e,t))}}),super[d.j.add](e,t)}[d.j.select](e,t,s){if(t===e?.[M])return;const a=this.selected;e&&(e[M]=t),(t?a!==e:a===e)&&(a&&(a[M]=!1),this.dispatchEvent(new i.vP("change",{detail:{prev:a,current:this.selected},trigger:s})))}}class x extends R{}class A extends R{#ue=!1;switch="current";get auto(){return this.#ue||this.readonly}[h.k.enableAuto];[d.j.onUserSelect](){this[h.k.setAuto](!1)}[d.j.onReset](e){this[h.k.enableAuto]=void 0,this[h.k.setAuto](!1,e)}autoSelect(e){this.readonly||this.#ue||!this[h.k.enableAuto]||(this[h.k.enableAuto]?.(e),this[h.k.setAuto](!0,e))}getBySrc(e){return this.items.find((t=>t.src===e))}[h.k.setAuto](e,t){this.#ue!==e&&(this.#ue=e,this.dispatchEvent(new i.vP("auto-change",{detail:e,trigger:t})))}}class O extends i.WO{}const Q=new Set(["Shift","Alt","Meta","Ctrl"]),D='input, textarea, select, [contenteditable], [role^="menuitem"], [role="timer"]';class F extends O{#Z;constructor(e){super(),this.#Z=e}onConnect(){(0,i.QZ)(this.#pe.bind(this))}#pe(){const{keyDisabled:e,keyTarget:t}=this.$props;if(e())return;const s="player"===t()?this.el:document,a=(0,i.O)(!1);s===this.el?new i.En(this.el).add("focusin",(()=>a.set(!0))).add("focusout",(e=>{this.el.contains(e.target)||a.set(!1)})):((0,i.se)(a)||a.set(document.querySelector("[data-media-player]")===this.el),(0,i.k6)(document,"focusin",(e=>{const t=e.composedPath().find((e=>e instanceof Element&&"media-player"===e.localName));void 0!==t&&a.set(this.el===t)}))),(0,i.QZ)((()=>{a()&&new i.En(s).add("keyup",this.#ge.bind(this)).add("keydown",this.#me.bind(this)).add("keydown",this.#ye.bind(this),{capture:!0})}))}#ge(e){const t=document.activeElement;if(!e.key||!this.$state.canSeek()||t?.matches(D))return;let{method:s,value:a}=this.#ve(e);if(!(0,i.Kg)(a)&&!(0,i.cy)(a))return a?.onKeyUp?.({event:e,player:this.#Z.player,remote:this.#Z.remote}),void a?.callback?.(e,this.#Z.remote);if(s?.startsWith("seek")&&(e.preventDefault(),e.stopPropagation(),this.#fe?(this.#ke(e,"seekForward"===s),this.#fe=null):(this.#Z.remote.seek(this.#we,e),this.#we=void 0)),s?.startsWith("volume")){const t=this.el.querySelector("[data-media-volume-slider]");t?.dispatchEvent(new KeyboardEvent("keyup",{key:"volumeUp"===s?"Up":"Down",shiftKey:e.shiftKey,trigger:e}))}}#me(e){if(!e.key||Q.has(e.key))return;const t=document.activeElement;if(t?.matches(D)||(0,i.SK)(e)&&t?.matches('button, [role="button"]'))return;let{method:s,value:a}=this.#ve(e),r=!e.metaKey&&/^[0-9]$/.test(e.key);if(!(0,i.Kg)(a)&&!(0,i.cy)(a)&&!r)return a?.onKeyDown?.({event:e,player:this.#Z.player,remote:this.#Z.remote}),void a?.callback?.(e,this.#Z.remote);if(!s&&r)return e.preventDefault(),e.stopPropagation(),void this.#Z.remote.seek(this.$state.duration()/10*Number(e.key),e);if(s){switch(e.preventDefault(),e.stopPropagation(),s){case"seekForward":case"seekBackward":this.#be(e,s,"seekForward"===s);break;case"volumeUp":case"volumeDown":const t=this.el.querySelector("[data-media-volume-slider]");if(t)t.dispatchEvent(new KeyboardEvent("keydown",{key:"volumeUp"===s?"Up":"Down",shiftKey:e.shiftKey,trigger:e}));else{const t=e.shiftKey?.1:.05;this.#Z.remote.changeVolume(this.$state.volume()+("volumeUp"===s?+t:-t),e)}break;case"toggleFullscreen":this.#Z.remote.toggleFullscreen("prefer-media",e);break;case"speedUp":case"slowDown":const i=this.$state.playbackRate();this.#Z.remote.changePlaybackRate(Math.max(.25,Math.min(2,i+("speedUp"===s?.25:-.25))),e);break;default:this.#Z.remote[s]?.(e)}this.$state.lastKeyboardAction.set({action:s,event:e})}}#ye(e){var t;(function(e){return e instanceof HTMLAudioElement}(t=e.target)||function(e){return e instanceof HTMLVideoElement}(t))&&this.#ve(e).method&&e.preventDefault()}#ve(e){const t={...this.$props.keyShortcuts(),...this.#Z.ariaKeys},s=Object.keys(t).find((s=>{const a=t[s],r=(0,i.cy)(a)?a.join(" "):(0,i.Kg)(a)?a:a?.keys,n=((0,i.cy)(r)?r:r?.split(" "))?.map((e=>function(e){return e.replace(/Shift\+(\d)/g,((e,t)=>V[t-1]))}(e).replace(/Control/g,"Ctrl").split("+")));return n?.some((t=>{const s=new Set(t.filter((e=>Q.has(e))));for(const t of Q){const i=t.toLowerCase()+"Key";if(!s.has(t)&&e[i])return!1}return t.every((t=>Q.has(t)?e[t.toLowerCase()+"Key"]:e.key===t.replace("Space"," ")))}))}));return{method:s,value:s?t[s]:null}}#we;#qe(e,t){const s=e.shiftKey?10:5;return this.#we=Math.max(0,Math.min((this.#we??this.$state.currentTime())+("seekForward"===t?+s:-s),this.$state.duration()))}#fe=null;#ke(e,t){this.#fe?.dispatchEvent(new KeyboardEvent(e.type,{key:t?"Right":"Left",shiftKey:e.shiftKey,trigger:e}))}#be(e,t,s){this.$state.canSeek()&&(this.#fe||(this.#fe=this.el.querySelector("[data-media-time-slider]")),this.#fe?this.#ke(e,s):this.#Z.remote.seeking(this.#qe(e,t),e))}}const V=["!","@","#","$","%","^","&","*","(",")"];class j extends O{#Te=-2;#Pe=!1;#$e=(0,i.O)(!1);#Ee=(0,i.O)(!1);#Se=null;#Ce=(0,i.O)(!0);defaultDelay=2e3;get canIdle(){return this.#Ce()}set canIdle(e){this.#Ce.set(e)}get hideOnMouseLeave(){const{hideControlsOnMouseLeave:e}=this.$props;return this.#$e()||e()}set hideOnMouseLeave(e){this.#$e.set(e)}get showing(){return this.$state.controlsVisible()}show(e=0,t){this.#Le(),this.#Pe||this.#Ie(!0,e,t)}hide(e=this.defaultDelay,t){this.#Le(),this.#Pe||this.#Ie(!1,e,t)}pause(e){this.#Pe=!0,this.#Le(),this.#Ie(!0,0,e)}resume(e){this.#Pe=!1,this.$state.paused()||this.#Ie(!1,this.defaultDelay,e)}onConnect(){(0,i.QZ)(this.#Me.bind(this))}#Me(){const{viewType:e}=this.$state;if(!this.el||!this.#Ce())return;if("audio"===e())return void this.show();(0,i.QZ)(this.#Re.bind(this)),(0,i.QZ)(this.#xe.bind(this));const t=this.#Ae.bind(this),s=this.#Oe.bind(this),a=this.#Qe.bind(this);new i.En(this.el).add("can-play",(e=>this.show(0,e))).add("play",t).add("pause",s).add("end",a).add("auto-play-fail",s)}#Re(){if(!this.el)return;const{started:e,pointer:t,paused:s}=this.$state;if(!e()||"fine"!==t())return;const a=new i.En(this.el),r=this.hideOnMouseLeave;r&&this.#Ee()||(0,i.QZ)((()=>{s()||a.add("pointermove",this.#De.bind(this))})),r&&a.add("mouseenter",this.#Fe.bind(this)).add("mouseleave",this.#Ve.bind(this))}#xe(){const{paused:e,started:t,autoPlayError:s}=this.$state;if(e()||s()&&!t())return;const a=this.#De.bind(this);(0,i.QZ)((()=>{if(!this.el)return;const e="coarse"===this.$state.pointer(),t=new i.En(this.el),s=[e?"touchend":"pointerup","keydown"];for(const e of s)t.add(e,a,{passive:!1})}))}#Ae(e){e.triggers.hasType("ended")||(this.show(0,e),this.hide(void 0,e))}#Oe(e){this.show(0,e)}#Qe(e){const{loop:t}=this.$state;t()&&this.hide(0,e)}#Fe(e){this.#Ee.set(!1),this.show(0,e),this.hide(void 0,e)}#Ve(e){this.#Ee.set(!0),this.hide(0,e)}#Le(){window.clearTimeout(this.#Te),this.#Te=-1}#De(e){e.MEDIA_GESTURE||this.#Pe||(0,u.Mb)(e)||((0,i.kx)(e)&&("Escape"===e.key?(this.el?.focus(),this.#Se=null):this.#Se&&(e.preventDefault(),requestAnimationFrame((()=>{this.#Se?.focus(),this.#Se=null})))),this.show(0,e),this.hide(this.defaultDelay,e))}#Ie(e,t,s){0!==t?this.#Te=window.setTimeout((()=>{this.scope&&this.#b(e&&!this.#Pe,s)}),t):this.#b(e,s)}#b(e,t){this.$state.controlsVisible()!==e&&(this.$state.controlsVisible.set(e),!e&&document.activeElement&&this.el?.contains(document.activeElement)&&(this.#Se=document.activeElement,requestAnimationFrame((()=>{this.el?.focus({preventScroll:!0})}))),this.dispatch("controls-change",{detail:e,trigger:t}))}}class z{name="audio";target;canPlay(e){return!!(0,r.fN)(e)&&(!(0,i.Kg)(e.src)||"?"===e.type||(0,r.Te)(this.target,e.type))}mediaType(){return"audio"}async load(e){return new((await Promise.all([s.e(657),s.e(70)]).then(s.bind(s,8070))).AudioProvider)(this.target,e)}}class K{name="video";target;canPlay(e){return!!(0,r._F)(e)&&(!(0,i.Kg)(e.src)||"?"===e.type||(0,r.EI)(this.target,e.type))}mediaType(){return"video"}async load(e){return new((await Promise.all([s.e(657),s.e(903)]).then(s.bind(s,4903))).VideoProvider)(this.target,e)}}class N extends K{static supported=(0,r.m0)();name="hls";canPlay(e){return N.supported&&(0,r.YJ)(e)}async load(e){return new((await Promise.all([s.e(657),s.e(317)]).then(s.bind(s,1317))).HLSProvider)(this.target,e)}}class W extends K{static supported=(0,r.Hh)();name="dash";canPlay(e){return W.supported&&(0,r.Pl)(e)}async load(e){return new((await Promise.all([s.e(657),s.e(434)]).then(s.bind(s,1434))).DASHProvider)(this.target,e)}}class G{name="vimeo";target;preconnect(){const e=["https://i.vimeocdn.com","https://f.vimeocdn.com","https://fresnel.vimeocdn.com"];for(const t of e)(0,l.kZ)(t)}canPlay(e){return(0,i.Kg)(e.src)&&"video/vimeo"===e.type}mediaType(){return"video"}async load(e){return new((await s.e(316).then(s.bind(s,1316))).VimeoProvider)(this.target,e)}async loadPoster(e,t,a){const{resolveVimeoVideoId:r,getVimeoVideoInfo:n}=await s.e(160).then(s.bind(s,3160));if(!(0,i.Kg)(e.src))return null;const{videoId:o,hash:d}=r(e.src);return o?n(o,a,d).then((e=>e?e.poster:null)):null}}class Z{name="youtube";target;preconnect(){const e=["https://www.google.com","https://i.ytimg.com","https://googleads.g.doubleclick.net","https://static.doubleclick.net"];for(const t of e)(0,l.kZ)(t)}canPlay(e){return(0,i.Kg)(e.src)&&"video/youtube"===e.type}mediaType(){return"video"}async load(e){return new((await s.e(901).then(s.bind(s,1901))).YouTubeProvider)(this.target,e)}async loadPoster(e,t,a){const{findYouTubePoster:r,resolveYouTubeVideoId:n}=await s.e(984).then(s.bind(s,8984)),o=(0,i.Kg)(e.src)&&n(e.src);return o?r(o,a):null}}const U=Symbol(0),B=["autoPlay","canAirPlay","canFullscreen","canGoogleCast","canLoad","canLoadPoster","canPictureInPicture","canPlay","canSeek","ended","fullscreen","isAirPlayConnected","isGoogleCastConnected","live","liveEdge","loop","mediaType","muted","paused","pictureInPicture","playing","playsInline","remotePlaybackState","remotePlaybackType","seeking","started","streamType","viewType","waiting"],H={artist:"",artwork:null,autoplay:!1,autoPlay:!1,clipStartTime:0,clipEndTime:0,controls:!1,currentTime:0,crossorigin:null,crossOrigin:null,duration:-1,fullscreenOrientation:"landscape",googleCast:{},load:"visible",posterLoad:"visible",logLevel:"silent",loop:!1,muted:!1,paused:!0,playsinline:!1,playsInline:!1,playbackRate:1,poster:"",preload:"metadata",preferNativeHLS:!1,src:"",title:"",controlsDelay:2e3,hideControlsOnMouseLeave:!1,viewType:"unknown",streamType:"unknown",volume:1,liveEdgeTolerance:10,minLiveDVRWindow:60,keyDisabled:!1,keyTarget:"player",keyShortcuts:{togglePaused:"k Space",toggleMuted:"m",toggleFullscreen:"f",togglePictureInPicture:"i",toggleCaptions:"c",seekBackward:"j J ArrowLeft",seekForward:"l L ArrowRight",volumeUp:"ArrowUp",volumeDown:"ArrowDown",speedUp:">",slowDown:"<"},storage:null};class _ extends O{#P;#je;constructor(e,t){super(),this.#P=e,this.#je=t}async onAttach(e){const t=this.$props[this.#P]();if("eager"===t)requestAnimationFrame(this.#je);else if("idle"===t)(0,i.As)(this.#je);else if("visible"===t){let t,s=new IntersectionObserver((e=>{this.scope&&e[0].isIntersecting&&(t?.(),t=void 0,this.#je())}));s.observe(e),t=(0,i.zp)((()=>s.disconnect()))}}}class J{#ze;#Z;constructor(e,t){this.#ze=e,this.#Z=t}notify(e,...t){this.#ze(new i.vP(e,{detail:t?.[0],trigger:t?.[1]}))}async ready(e,t){return(0,i.vz)((async()=>{this.#Z;const{autoPlay:s,canPlay:a,started:r,duration:n,seekable:o,buffered:d,remotePlaybackInfo:h,playsInline:c,savedState:l,source:u}=this.#Z.$state;if(a())return;const p={duration:e?.duration??n(),seekable:e?.seekable??o(),buffered:e?.buffered??d(),provider:this.#Z.$provider()};this.notify("can-play",p,t),(0,i.io)();let g=this.#Z.$provider(),{storage:m,qualities:y}=this.#Z,{muted:v,volume:f,clipStartTime:k,playbackRate:w}=this.#Z.$props;await(m?.onLoad?.(u()));const b=l()?.currentTime,q=l()?.paused,T=await(m?.getTime()),P=b??T??k(),$=q||!1!==q&&!r()&&s();if(g){g.setVolume(await(m?.getVolume())??f()),g.setMuted(v()||!!await(m?.getMuted()));const e=await(m?.getAudioGain())??1;e>1&&g.audioGain?.setGain?.(e),g.setPlaybackRate?.(await(m?.getPlaybackRate())??w()),g.setPlaysInline?.(c()),P>0&&g.setCurrentTime(P)}const E=await(m?.getVideoQuality());if(E&&y.length){let e=null,t=1/0;for(const s of y){const i=Math.abs(E.width-s.width)+Math.abs(E.height-s.height)+(E.bitrate?Math.abs(E.bitrate-(s.bitrate??0)):0);i<t&&(e=s,t=i)}e&&(e.selected=!0)}a()&&$?await this.#Ke(t):T&&T>0&&this.notify("started",void 0,t),h.set(null)}))}async#Ke(e){const{player:t,$state:{autoPlaying:s,muted:a}}=this.#Z;s.set(!0);const r=new i.vP("auto-play-attempt",{trigger:e});try{await t.play(r)}catch(e){}}}class X{#Ne=new Map;enqueue(e,t){this.#Ne.set(e,t)}serve(e){const t=this.peek(e);return this.#Ne.delete(e),t}peek(e){return this.#Ne.get(e)}delete(e){this.#Ne.delete(e)}clear(){this.#Ne.clear()}}class Y{#We=!1;#Ge=(0,i.vI)();#Ne=new Map;get size(){return this.#Ne.size}get isServing(){return this.#We}async waitForFlush(){this.#We||await this.#Ge.promise}enqueue(e,t){this.#We?t():(this.#Ne.delete(e),this.#Ne.set(e,t))}serve(e){this.#Ne.get(e)?.(),this.#Ne.delete(e)}start(){this.#Ze(),this.#We=!0,this.#Ne.size>0&&this.#Ze()}stop(){this.#We=!1}reset(){this.stop(),this.#Ne.clear(),this.#Ue()}#Ze(){for(const e of this.#Ne.keys())this.serve(e);this.#Ue()}#Ue(){this.#Ge.resolve(),this.#Ge=(0,i.vI)()}}class ee extends O{#Be;#He;#Z;controls;#_e;#Je;#Xe;#Ye=new Y;constructor(e,t,s){super(),this.#Be=e,this.#He=t,this.#Z=s,this.#Xe=s.$provider,this.controls=new j,this.#_e=new v,this.#Je=new w}onAttach(){this.listen("fullscreen-change",this.#et.bind(this))}onConnect(e){const t=Object.getOwnPropertyNames(Object.getPrototypeOf(this)),s=new i.En(e),a=this.#tt.bind(this);for(const e of t)e.startsWith("media-")&&s.add(e,a);this.#st(),(0,i.QZ)(this.#it.bind(this)),(0,i.QZ)(this.#at.bind(this)),(0,i.QZ)(this.#rt.bind(this)),(0,i.QZ)(this.#nt.bind(this)),(0,i.QZ)(this.#ot.bind(this)),(0,i.QZ)(this.#dt.bind(this)),(0,i.QZ)(this.#ht.bind(this))}onDestroy(){try{const e=this.createEvent("destroy"),{pictureInPicture:t,fullscreen:s}=this.$state;s()&&this.exitFullscreen("prefer-media",e),t()&&this.exitPictureInPicture(e)}catch(e){}this.#Ye.reset()}#st(){const{load:e}=this.$props,{canLoad:t}=this.$state;if("play"!==e()||t())return;const s=this.listen("media-play-request",(e=>{this.#ct(e),s()}))}#it(){const e=this.#Xe(),t=this.$state.canPlay();return e&&t&&this.#Ye.start(),()=>{this.#Ye.stop()}}#tt(e){e.stopPropagation(),e.defaultPrevented||this[e.type]&&((0,i.se)(this.#Xe)?this[e.type](e):this.#Ye.enqueue(e.type,(()=>{(0,i.se)(this.#Xe)&&this[e.type](e)})))}async play(e){const{canPlay:t,paused:s,autoPlaying:a}=this.$state;if(this.#ct(e))return;if(!(0,i.se)(s))return;e&&this.#He.queue.enqueue("media-play-request",e);const r=(0,i.se)(a);try{const e=(0,i.se)(this.#Xe);return te(e,(0,i.se)(t)),await e.play()}catch(t){const s=this.createEvent("play-fail",{detail:(0,c.r)(t),trigger:e});throw s.autoPlay=r,this.#Be.handle(s),t}}#ct(e){const{load:t}=this.$props,{canLoad:s}=this.$state;if("play"===t()&&!s()){const t=this.createEvent("media-start-loading",{trigger:e});return this.dispatchEvent(t),this.#Ye.enqueue("media-play-request",(async()=>{try{await this.play(t)}catch(e){}})),!0}return!1}async pause(e){const{canPlay:t,paused:s}=this.$state;if(!(0,i.se)(s)){e&&this.#He.queue.enqueue("media-pause-request",e);try{const e=(0,i.se)(this.#Xe);return te(e,(0,i.se)(t)),await e.pause()}catch(e){throw this.#He.queue.delete("media-pause-request"),e}}}setAudioGain(e,t){const{audioGain:s,canSetAudioGain:i}=this.$state;if(s()===e)return;const a=this.#Xe();if(!a?.audioGain||!i())throw Error("[vidstack] audio gain api not available");t&&this.#He.queue.enqueue("media-audio-gain-change-request",t),a.audioGain.setGain(e)}seekToLiveEdge(e){const{canPlay:t,live:s,liveEdge:a,canSeek:r,liveSyncPosition:n,seekableEnd:o,userBehindLiveEdge:d}=this.$state;if(d.set(!1),(0,i.se)((()=>!s()||a()||!r())))return;const h=(0,i.se)(this.#Xe);te(h,(0,i.se)(t)),e&&this.#He.queue.enqueue("media-seek-request",e);const c=o()-2;h.setCurrentTime(Math.min(c,n()??c))}#lt=!1;async enterFullscreen(e="prefer-media",t){const s=this.#ut(e);if(se(0,s),!s.active)return(0,i.se)(this.$state.pictureInPicture)&&(this.#lt=!0,await this.exitPictureInPicture(t)),t&&this.#He.queue.enqueue("media-enter-fullscreen-request",t),s.enter()}async exitFullscreen(e="prefer-media",t){const s=this.#ut(e);if(se(0,s),s.active){t&&this.#He.queue.enqueue("media-exit-fullscreen-request",t);try{const e=await s.exit();return this.#lt&&(0,i.se)(this.$state.canPictureInPicture)&&await this.enterPictureInPicture(),e}finally{this.#lt=!1}}}#ut(e){const t=(0,i.se)(this.#Xe);return"prefer-media"===e&&this.#_e.supported||"media"===e?this.#_e:t?.fullscreen}async enterPictureInPicture(e){if(this.#pt(),!this.$state.pictureInPicture())return e&&this.#He.queue.enqueue("media-enter-pip-request",e),await this.#Xe().pictureInPicture.enter()}async exitPictureInPicture(e){if(this.#pt(),this.$state.pictureInPicture())return e&&this.#He.queue.enqueue("media-exit-pip-request",e),await this.#Xe().pictureInPicture.exit()}#pt(){if(!this.$state.canPictureInPicture())throw Error("[vidstack] no pip support")}#at(){this.controls.defaultDelay=this.$props.controlsDelay()}#rt(){const{canSetAudioGain:e}=this.$state,t=!!this.#Xe()?.audioGain?.supported;e.set(t)}#nt(){const{canAirPlay:e}=this.$state,t=!!this.#Xe()?.airPlay?.supported;e.set(t)}#ot(){const{canGoogleCast:e,source:t}=this.$state,s=r.G_&&!r.pz&&(0,r.jx)(t());e.set(s)}#dt(){const{canFullscreen:e}=this.$state,t=this.#_e.supported||!!this.#Xe()?.fullscreen?.supported;e.set(t)}#ht(){const{canPictureInPicture:e}=this.$state,t=!!this.#Xe()?.pictureInPicture?.supported;e.set(t)}async"media-airplay-request"(e){try{await this.requestAirPlay(e)}catch(e){}}async requestAirPlay(e){try{const t=this.#Xe()?.airPlay;if(!t?.supported)throw Error("No AirPlay adapter.");return e&&this.#He.queue.enqueue("media-airplay-request",e),await t.prompt()}catch(e){throw this.#He.queue.delete("media-airplay-request"),e}}async"media-google-cast-request"(e){try{await this.requestGoogleCast(e)}catch(e){}}#gt;async requestGoogleCast(e){try{const{canGoogleCast:t}=this.$state;if(!(0,i.se)(t)){const e=Error("Cast not available.");throw e.code="CAST_NOT_AVAILABLE",e}if((0,l.kZ)("https://www.gstatic.com"),!this.#gt){const e=await s.e(254).then(s.bind(s,1873));this.#gt=new e.GoogleCastLoader}await this.#gt.prompt(this.#Z),e&&this.#He.queue.enqueue("media-google-cast-request",e);const a="disconnected"!==(0,i.se)(this.$state.remotePlaybackState);a&&this.$state.savedState.set({paused:(0,i.se)(this.$state.paused),currentTime:(0,i.se)(this.$state.currentTime)}),this.$state.remotePlaybackLoader.set(a?this.#gt:null)}catch(e){throw this.#He.queue.delete("media-google-cast-request"),e}}"media-clip-start-change-request"(e){const{clipStartTime:t}=this.$state;t.set(e.detail)}"media-clip-end-change-request"(e){const{clipEndTime:t}=this.$state;t.set(e.detail),this.dispatch("duration-change",{detail:e.detail,trigger:e})}"media-duration-change-request"(e){const{providedDuration:t,clipEndTime:s}=this.$state;t.set(e.detail),s()<=0&&this.dispatch("duration-change",{detail:e.detail,trigger:e})}"media-audio-track-change-request"(e){const{logger:t,audioTracks:s}=this.#Z;if(s.readonly)return;const i=s[e.detail];if(i){const t=e.type;this.#He.queue.enqueue(t,e),i.selected=!0}}async"media-enter-fullscreen-request"(e){try{await this.enterFullscreen(e.detail,e)}catch(t){this.#mt(t,e)}}async"media-exit-fullscreen-request"(e){try{await this.exitFullscreen(e.detail,e)}catch(t){this.#mt(t,e)}}async#et(e){const t=(0,i.se)(this.$props.fullscreenOrientation),s=e.detail;if(!(0,i.b0)(t)&&"none"!==t&&this.#Je.supported)if(s){if(this.#Je.locked)return;this.dispatch("media-orientation-lock-request",{detail:t,trigger:e})}else this.#Je.locked&&this.dispatch("media-orientation-unlock-request",{trigger:e})}#mt(e,t){this.#Be.handle(this.createEvent("fullscreen-error",{detail:(0,c.r)(e)}))}async"media-orientation-lock-request"(e){const t=e.type;try{this.#He.queue.enqueue(t,e),await this.#Je.lock(e.detail)}catch(e){this.#He.queue.delete(t)}}async"media-orientation-unlock-request"(e){const t=e.type;try{this.#He.queue.enqueue(t,e),await this.#Je.unlock()}catch(e){this.#He.queue.delete(t)}}async"media-enter-pip-request"(e){try{await this.enterPictureInPicture(e)}catch(t){this.#yt(t,e)}}async"media-exit-pip-request"(e){try{await this.exitPictureInPicture(e)}catch(t){this.#yt(t,e)}}#yt(e,t){this.#Be.handle(this.createEvent("picture-in-picture-error",{detail:(0,c.r)(e)}))}"media-live-edge-request"(e){const{live:t,liveEdge:s,canSeek:i}=this.$state;if(t()&&!s()&&i()){this.#He.queue.enqueue("media-seek-request",e);try{this.seekToLiveEdge()}catch(e){this.#He.queue.delete("media-seek-request")}}}async"media-loop-request"(e){try{this.#He.looping=!0,this.#He.replaying=!0,await this.play(e)}catch(e){this.#He.looping=!1}}"media-user-loop-change-request"(e){this.$state.userPrefersLoop.set(e.detail)}async"media-pause-request"(e){if(!this.$state.paused())try{await this.pause(e)}catch(e){}}async"media-play-request"(e){if(this.$state.paused())try{await this.play(e)}catch(e){}}"media-rate-change-request"(e){const{playbackRate:t,canSetPlaybackRate:s}=this.$state;if(t()===e.detail||!s())return;const i=this.#Xe();i?.setPlaybackRate&&(this.#He.queue.enqueue("media-rate-change-request",e),i.setPlaybackRate(e.detail))}"media-audio-gain-change-request"(e){try{this.setAudioGain(e.detail,e)}catch(e){}}"media-quality-change-request"(e){const{qualities:t,storage:s,logger:i}=this.#Z;if(t.readonly)return;this.#He.queue.enqueue("media-quality-change-request",e);const a=e.detail;if(a<0)t.autoSelect(e),e.isOriginTrusted&&s?.setVideoQuality?.(null);else{const i=t[a];i&&(i.selected=!0,e.isOriginTrusted&&s?.setVideoQuality?.({id:i.id,width:i.width,height:i.height,bitrate:i.bitrate}))}}"media-pause-controls-request"(e){const t=e.type;this.#He.queue.enqueue(t,e),this.controls.pause(e)}"media-resume-controls-request"(e){const t=e.type;this.#He.queue.enqueue(t,e),this.controls.resume(e)}"media-seek-request"(e){const{seekableStart:t,seekableEnd:s,ended:i,canSeek:a,live:r,userBehindLiveEdge:n,clipStartTime:o}=this.$state,d=e.detail;i()&&(this.#He.replaying=!0);const h=e.type;this.#He.seeking=!1,this.#He.queue.delete(h);const c=d+o(),l=Math.floor(d)===Math.floor(t()),u=Math.floor(c)===Math.floor(s()),p=l?t():u?s():Math.min(Math.max(t()+.1,c),s()-.1);Number.isFinite(p)&&a()&&(this.#He.queue.enqueue(h,e),this.#Xe().setCurrentTime(p),r()&&e.isOriginTrusted&&Math.abs(s()-p)>=2&&n.set(!0))}"media-seeking-request"(e){const t=e.type;this.#He.queue.enqueue(t,e),this.$state.seeking.set(!0),this.#He.seeking=!0}"media-start-loading"(e){if(this.$state.canLoad())return;const t=e.type;this.#He.queue.enqueue(t,e),this.#Be.handle(this.createEvent("can-load"))}"media-poster-start-loading"(e){if(this.$state.canLoadPoster())return;const t=e.type;this.#He.queue.enqueue(t,e),this.#Be.handle(this.createEvent("can-load-poster"))}"media-text-track-change-request"(e){const{index:t,mode:s}=e.detail,i=this.#Z.textTracks[t];if(i){const t=e.type;this.#He.queue.enqueue(t,e),i.setMode(s,e)}}"media-mute-request"(e){if(this.$state.muted())return;const t=e.type;this.#He.queue.enqueue(t,e),this.#Xe().setMuted(!0)}"media-unmute-request"(e){const{muted:t,volume:s}=this.$state;if(!t())return;const i=e.type;this.#He.queue.enqueue(i,e),this.#Z.$provider().setMuted(!1),0===s()&&(this.#He.queue.enqueue(i,e),this.#Xe().setVolume(.25))}"media-volume-change-request"(e){const{muted:t,volume:s}=this.$state,i=e.detail;if(s()===i)return;const a=e.type;this.#He.queue.enqueue(a,e),this.#Xe().setVolume(i),i>0&&t()&&(this.#He.queue.enqueue(a,e),this.#Xe().setMuted(!1))}#vt(e,t,s){}}function te(e,t){if(!e||!t)throw Error("[vidstack] media not ready")}function se(e,t){if(!t?.supported)throw Error("[vidstack] no fullscreen support")}class ie{seeking=!1;looping=!1;replaying=!1;queue=new X}const ae=new Set(["auto-play","auto-play-fail","can-load","sources-change","source-change","load-start","abort","error","loaded-metadata","loaded-data","can-play","play","play-fail","pause","playing","seeking","seeked","waiting"]);class re extends O{#He;#Z;#ft=new Map;#kt=!1;#wt=[];#bt=[-1,-1];#qt=!1;#Tt;constructor(e,t){super(),this.#He=e,this.#Z=t}onAttach(e){e.setAttribute("aria-busy","true"),new i.En(this).add("fullscreen-change",this["fullscreen-change"].bind(this)).add("fullscreen-error",this["fullscreen-error"].bind(this)).add("orientation-change",this["orientation-change"].bind(this))}onConnect(e){(0,i.QZ)(this.#Pt.bind(this)),this.#$t(),this.#Et(),this.#St(),this.#Ct(),(0,i.zp)(this.#Lt.bind(this))}onDestroy(){const{audioTracks:e,qualities:t,textTracks:s}=this.#Z;e[d.j.reset](),t[d.j.reset](),s[d.j.reset](),this.#It()}handle(e){if(!this.scope)return;const t=e.type;(0,i.vz)((()=>this[e.type]?.(e))),ae.has(t)&&this.#ft.set(t,e),this.dispatch(e)}#Mt=!1;#Ct(){this.#Mt&&(requestAnimationFrame((()=>{this.scope&&this.#Z.remote.play(new i.vP("dom-connect"))})),this.#Mt=!1)}#Lt(){this.#Mt||(this.#Mt=!this.$state.paused(),this.#Z.$provider()?.pause())}#Rt(){this.#xt(),this.#kt=!1,this.#He.replaying=!1,this.#He.looping=!1,this.#qt=!1,this.#Tt=void 0,this.#ft.clear()}#At(e,t){const s=this.#He.queue.serve(e);s&&(t.request=s,t.triggers.add(s))}#$t(){this.#Ot(),this.#Qt();const e=this.#Z.textTracks;new i.En(e).add("add",this.#Ot.bind(this)).add("remove",this.#Ot.bind(this)).add("mode-change",this.#Qt.bind(this))}#Et(){const e=this.#Z.qualities;new i.En(e).add("add",this.#Dt.bind(this)).add("remove",this.#Dt.bind(this)).add("change",this.#Ft.bind(this)).add("auto-change",this.#Vt.bind(this)).add("readonly-change",this.#jt.bind(this))}#St(){const e=this.#Z.audioTracks;new i.En(e).add("add",this.#zt.bind(this)).add("remove",this.#zt.bind(this)).add("change",this.#Kt.bind(this))}#Ot(e){const{textTracks:t}=this.$state;t.set(this.#Z.textTracks.toArray()),this.dispatch("text-tracks-change",{detail:t(),trigger:e})}#Qt(e){e&&this.#At("media-text-track-change-request",e);const t=this.#Z.textTracks.selected,{textTrack:s}=this.$state;s()!==t&&(s.set(t),this.dispatch("text-track-change",{detail:t,trigger:e}))}#zt(e){const{audioTracks:t}=this.$state;t.set(this.#Z.audioTracks.toArray()),this.dispatch("audio-tracks-change",{detail:t(),trigger:e})}#Kt(e){const{audioTrack:t}=this.$state;t.set(this.#Z.audioTracks.selected),e&&this.#At("media-audio-track-change-request",e),this.dispatch("audio-track-change",{detail:t(),trigger:e})}#Dt(e){const{qualities:t}=this.$state;t.set(this.#Z.qualities.toArray()),this.dispatch("qualities-change",{detail:t(),trigger:e})}#Ft(e){const{quality:t}=this.$state;t.set(this.#Z.qualities.selected),e&&this.#At("media-quality-change-request",e),this.dispatch("quality-change",{detail:t(),trigger:e})}#Vt(){const{qualities:e}=this.#Z,t=e.auto;this.$state.autoQuality.set(t),t||this.#It()}#Nt=null;#Wt(){this.#It(),this.#Nt=(0,i.QZ)((()=>{const{qualities:e}=this.#Z,{mediaWidth:t,mediaHeight:s}=this.$state,a=t(),r=s();if(0===a||0===r)return;let n=null,o=1/0;for(const t of e){const e=Math.abs(t.width-a)+Math.abs(t.height-r);e<o&&(o=e,n=t)}n&&e[d.j.select](n,!0,new i.vP("resize",{detail:{width:a,height:r}}))}))}#It(){this.#Nt?.(),this.#Nt=null}#jt(){this.$state.canSetQuality.set(!this.#Z.qualities.readonly)}#Pt(){const{canSetVolume:e,isGoogleCastConnected:t}=this.$state;t()?e.set(!1):(0,r.v4)().then(e.set)}"provider-change"(e){const t=this.#Z.$provider(),s=e.detail;t?.type!==s?.type&&(t?.destroy?.(),t?.scope?.dispose(),this.#Z.$provider.set(e.detail),t&&null===e.detail&&this.#Gt(e))}"provider-loader-change"(e){}"auto-play"(e){this.$state.autoPlayError.set(null)}"auto-play-fail"(e){this.$state.autoPlayError.set(e.detail),this.#Rt()}"can-load"(e){this.$state.canLoad.set(!0),this.#ft.set("can-load",e),this.#Z.textTracks[o.Hp.canLoad](),this.#At("media-start-loading",e)}"can-load-poster"(e){this.$state.canLoadPoster.set(!0),this.#ft.set("can-load-poster",e),this.#At("media-poster-start-loading",e)}"media-type-change"(e){const t=this.#ft.get("source-change");t&&e.triggers.add(t);const s=this.$state.viewType();this.$state.mediaType.set(e.detail);const i=this.$state.providedViewType(),a="unknown"===i?e.detail:i;s!==a&&setTimeout((()=>{requestAnimationFrame((()=>{this.scope&&(this.$state.inferredViewType.set(e.detail),this.dispatch("view-type-change",{detail:a,trigger:e}))}))}),0)}"stream-type-change"(e){const t=this.#ft.get("source-change");t&&e.triggers.add(t);const{streamType:s,inferredStreamType:i}=this.$state;i.set(e.detail),e.detail=s()}"rate-change"(e){const{storage:t}=this.#Z,{canPlay:s}=this.$state;this.$state.playbackRate.set(e.detail),this.#At("media-rate-change-request",e),s()&&t?.setPlaybackRate?.(e.detail)}"remote-playback-change"(e){const{remotePlaybackState:t,remotePlaybackType:s}=this.$state,{type:i,state:a}=e.detail,r="connected"===a;s.set(i),t.set(a);const n="airplay"===i?"media-airplay-request":"media-google-cast-request";if(r)this.#At(n,e);else{const t=this.#He.queue.peek(n);t&&(e.request=t,e.triggers.add(t))}}"sources-change"(e){const t=this.$state.sources(),s=e.detail;this.$state.sources.set(s),this.#Zt(t,s,e)}#Zt(e,t,s){let{qualities:i}=this.#Z,a=!1,r=!1;for(const a of e)if(b(a)&&!t.some((e=>e.src===a.src))){const e=i.getBySrc(a.src);e&&(i[d.j.remove](e,s),r=!0)}r&&!i.length&&(this.$state.savedState.set(null),i[d.j.reset](s));for(const e of t){if(!b(e)||i.getBySrc(e.src))continue;const t={id:e.id??e.height+"p",bitrate:null,codec:null,...e,selected:!1};i[d.j.add](t,s),a=!0}a&&!i[h.k.enableAuto]&&(this.#Wt(),i[h.k.enableAuto]=this.#Wt.bind(this),i[h.k.setAuto](!0,s))}"source-change"(e){e.isQualityChange="quality-change"===e.originEvent?.type;const t=e.detail;this.#Gt(e,e.isQualityChange),this.#ft.set(e.type,e),this.$state.source.set(t),this.el?.setAttribute("aria-busy","true")}#Gt(e,t=!1){const{audioTracks:s,qualities:i}=this.#Z;if(!t)return this.#wt=[],this.#bt=[-1,-1],s[d.j.reset](e),i[d.j.reset](e),$(this.$state,t),void this.#Rt();$(this.$state,t),this.#Rt()}abort(e){const t=this.#ft.get("source-change");t&&e.triggers.add(t);const s=this.#ft.get("can-load");s&&!e.triggers.hasType("can-load")&&e.triggers.add(s)}"load-start"(e){const t=this.#ft.get("source-change");t&&e.triggers.add(t)}error(e){this.$state.error.set(e.detail);const t=this.#ft.get("abort");t&&e.triggers.add(t)}"loaded-metadata"(e){const t=this.#ft.get("load-start");t&&e.triggers.add(t)}"loaded-data"(e){const t=this.#ft.get("load-start");t&&e.triggers.add(t)}"can-play"(e){const t=this.#ft.get("loaded-metadata");t&&e.triggers.add(t),this.#Ut(e.detail),this.el?.setAttribute("aria-busy","false")}"can-play-through"(e){this.#Ut(e.detail);const t=this.#ft.get("can-play");t&&e.triggers.add(t)}#Ut(e){const{seekable:t,buffered:s,intrinsicDuration:i,canPlay:a}=this.$state;a.set(!0),s.set(e.buffered),t.set(e.seekable);const r=(0,n.BE)(e.seekable)??1/0;i.set(r)}"duration-change"(e){const{live:t,intrinsicDuration:s,providedDuration:i,clipEndTime:a,ended:r}=this.$state,n=e.detail;if(!t()){const t=Number.isNaN(n)?0:n;s.set(t),r()&&this.#Bt(e)}(i()>0||a()>0)&&e.stopImmediatePropagation()}progress(e){const{buffered:t,bufferedEnd:s,seekable:i,seekableEnd:a,live:r,intrinsicDuration:o}=this.$state,{buffered:d,seekable:h}=e.detail,c=(0,n.BE)(d)??1/0,l=d.length!==t().length,u=c>s(),p=(0,n.BE)(h)??1/0,g=h.length!==i().length,m=p>a();(l||u)&&t.set(d),(g||m)&&i.set(h),r()&&(o.set(p),this.dispatch("duration-change",{detail:p,trigger:e}))}play(e){const{paused:t,autoPlayError:s,ended:i,autoPlaying:a,playsInline:r,pointer:n,muted:o,viewType:d,live:h,userBehindLiveEdge:c}=this.$state;if(this.#Ht(),!t())return void e.stopImmediatePropagation();e.autoPlay=a();const l=this.#ft.get("waiting");l&&e.triggers.add(l),this.#At("media-play-request",e),this.#ft.set("play",e),t.set(!1),s.set(null),e.autoPlay&&(this.handle(this.createEvent("auto-play",{detail:{muted:o()},trigger:e})),a.set(!1)),(i()||this.#He.replaying)&&(this.#He.replaying=!1,i.set(!1),this.handle(this.createEvent("replay",{trigger:e}))),r()||"video"!==d()||"coarse"!==n()||this.#Z.remote.enterFullscreen("prefer-media",e),h()&&!c()&&this.#Z.remote.seekToLiveEdge(e)}#Ht(e){if(!(0,i.se)(this.#Z.$provider))return;const{ended:t,seekableStart:s,clipStartTime:a,clipEndTime:r,currentTime:n,realCurrentTime:o,duration:d}=this.$state,h=t()||o()<a()||r()>0&&o()>=r()||Math.abs(n()-d())<.1;return h&&this.dispatch("media-seek-request",{detail:s(),trigger:e}),h}"play-fail"(e){const{muted:t,autoPlaying:s}=this.$state,i=this.#ft.get("play");i&&e.triggers.add(i),this.#At("media-play-request",e);const{paused:a,playing:r}=this.$state;a.set(!0),r.set(!1),this.#Rt(),this.#ft.set("play-fail",e),e.autoPlay&&(this.handle(this.createEvent("auto-play-fail",{detail:{muted:t(),error:e.detail},trigger:e})),s.set(!1))}playing(e){const t=this.#ft.get("play"),s=this.#ft.get("seeked");t?e.triggers.add(t):s&&e.triggers.add(s),setTimeout((()=>this.#Rt()),0);const{paused:i,playing:a,live:r,liveSyncPosition:n,seekableEnd:o,started:d,currentTime:h,seeking:c,ended:l}=this.$state;if(i.set(!1),a.set(!0),c.set(!1),l.set(!1),this.#He.looping)this.#He.looping=!1;else{if(r()&&!d()&&0===h()){const e=n()??o()-2;Number.isFinite(e)&&this.#Z.$provider().setCurrentTime(e)}this.started(e)}}started(e){const{started:t}=this.$state;t()||(t.set(!0),this.handle(this.createEvent("started",{trigger:e})))}pause(e){this.el?.isConnected||(this.#Mt=!0),this.#At("media-pause-request",e);const t=this.#ft.get("seeked");t&&e.triggers.add(t);const{paused:s,playing:i}=this.$state;s.set(!0),i.set(!1),this.#kt&&setTimeout((()=>{this.handle(this.createEvent("end",{trigger:e})),this.#kt=!1}),0),this.#Rt()}"time-change"(e){if(this.#He.looping)return void e.stopImmediatePropagation();let{waiting:t,played:s,clipEndTime:i,realCurrentTime:a,currentTime:r}=this.$state,n=e.detail,d=i();a.set(n),this.#_t(),t.set(!1);for(const t of this.#Z.textTracks)t[o.Hp.updateActiveCues](n,e);d>0&&n>=d&&(this.#kt=!0,this.dispatch("media-pause-request",{trigger:e})),this.#Jt(),this.dispatch("time-update",{detail:{currentTime:r(),played:s()},trigger:e})}#_t(){const{currentTime:e,played:t,paused:s}=this.$state;s()||(this.#bt=(0,n.JG)(this.#wt,this.#bt,e()),t.set(new n.zJ(this.#wt)))}#Bt(e){const{clipStartTime:t,clipEndTime:s,duration:i}=this.$state;t()>0||s()>0||this.handle(this.createEvent("time-change",{detail:i(),trigger:e}))}#Jt(){const{storage:e}=this.#Z,{canPlay:t,realCurrentTime:s}=this.$state;t()&&e?.setTime?.(s())}"audio-gain-change"(e){const{storage:t}=this.#Z,{canPlay:s,audioGain:i}=this.$state;i.set(e.detail),this.#At("media-audio-gain-change-request",e),s()&&t?.setAudioGain?.(i())}"volume-change"(e){const{storage:t}=this.#Z,{volume:s,muted:i,canPlay:a}=this.$state,r=e.detail;s.set(r.volume),i.set(r.muted||0===r.volume),this.#At("media-volume-change-request",e),this.#At(r.muted?"media-mute-request":"media-unmute-request",e),a()&&(t?.setVolume?.(s()),t?.setMuted?.(i()))}seeking=(0,i.z3)((e=>{const{seeking:t,realCurrentTime:s,paused:i}=this.$state;t.set(!0),s.set(e.detail),this.#At("media-seeking-request",e),i()&&(this.#Tt=e,this.#Xt()),this.#bt=[-1,-1]}),150,{leading:!0});seeked(e){const{seeking:t,currentTime:s,realCurrentTime:i,paused:a,seekableEnd:r,ended:n}=this.$state;if(this.#He.seeking)t.set(!0),e.stopImmediatePropagation();else if(t()){const s=this.#ft.get("waiting");s&&e.triggers.add(s);const r=this.#ft.get("seeking");r&&!e.triggers.has(r)&&e.triggers.add(r),a()&&this.#xt(),t.set(!1),i.set(e.detail),this.#At("media-seek-request",e);const n=e?.originEvent;!n?.isTrusted||n instanceof MessageEvent||/seek/.test(n.type)||this.started(e)}Math.floor(s())!==Math.floor(r())?n.set(!1):this.end(e)}waiting(e){this.#qt||this.#He.seeking||(e.stopImmediatePropagation(),this.#Tt=e,this.#Xt())}#Xt=(0,i.IO)((()=>{if(!this.#Tt)return;this.#qt=!0;const{waiting:e,playing:t}=this.$state;e.set(!0),t.set(!1);const s=this.createEvent("waiting",{trigger:this.#Tt});this.#ft.set("waiting",s),this.dispatch(s),this.#Tt=void 0,this.#qt=!1}),300);end(e){const{loop:t,ended:s}=this.$state;!t()&&s()||(t()?setTimeout((()=>{requestAnimationFrame((()=>{this.#Ht(e),this.dispatch("media-loop-request",{trigger:e})}))}),10):setTimeout((()=>this.#Yt(e)),0))}#Yt(e){const{storage:t}=this.#Z,{paused:s,seeking:i,ended:a,duration:r}=this.$state;this.#Bt(e),s()||this.dispatch("pause",{trigger:e}),i()&&this.dispatch("seeked",{detail:r(),trigger:e}),a.set(!0),this.#Rt(),t?.setTime?.(r(),!0),this.dispatch("ended",{trigger:e})}#xt(){this.#Xt.cancel(),this.$state.waiting.set(!1)}"fullscreen-change"(e){const t=e.detail;this.$state.fullscreen.set(t),this.#At(t?"media-enter-fullscreen-request":"media-exit-fullscreen-request",e)}"fullscreen-error"(e){this.#At("media-enter-fullscreen-request",e),this.#At("media-exit-fullscreen-request",e)}"orientation-change"(e){const t=e.detail.lock;this.#At(t?"media-orientation-lock-request":"media-orientation-unlock-request",e)}"picture-in-picture-change"(e){const t=e.detail;this.$state.pictureInPicture.set(t),this.#At(t?"media-enter-pip-request":"media-exit-pip-request",e)}"picture-in-picture-error"(e){this.#At("media-enter-pip-request",e),this.#At("media-exit-pip-request",e)}"title-change"(e){e.trigger&&(e.stopImmediatePropagation(),this.$state.inferredTitle.set(e.detail))}"poster-change"(e){e.trigger&&(e.stopImmediatePropagation(),this.$state.inferredPoster.set(e.detail))}}class ne extends O{onSetup(){this.#Me();const e=[this.#es,this.#ts,this.#ss,this.#is,this.#_,this.#as,this.#rs,this.#ns,this.#os,this.#ds,this.#hs,this.#cs,this.#ls,this.#us,this.#ps];for(const t of e)(0,i.QZ)(t.bind(this))}#Me(){const e={duration:"providedDuration",loop:"providedLoop",poster:"providedPoster",streamType:"providedStreamType",title:"providedTitle",viewType:"providedViewType"},t=new Set(["currentTime","paused","playbackRate","volume"]);for(const s of Object.keys(this.$props))t.has(s)||this.$state[e[s]??s]?.set(this.$props[s]());this.$state.muted.set(this.$props.muted()||0===this.$props.volume())}#us(){const{viewType:e,streamType:t,title:s,poster:i,loop:a}=this.$props,r=this.$state;r.providedPoster.set(i()),r.providedStreamType.set(t()),r.providedViewType.set(e()),r.providedTitle.set(s()),r.providedLoop.set(a())}#gs(){}#es(){const{artist:e,artwork:t}=this.$props;this.$state.artist.set(e()),this.$state.artwork.set(t())}#ps(){const{title:e}=this.$state;this.dispatch("title-change",{detail:e()})}#ts(){const e=this.$props.autoPlay()||this.$props.autoplay();this.$state.autoPlay.set(e),this.dispatch("auto-play-change",{detail:e})}#hs(){const e=this.$state.loop();this.dispatch("loop-change",{detail:e})}#_(){const e=this.$props.controls();this.$state.controls.set(e)}#ls(){const{poster:e}=this.$state;this.dispatch("poster-change",{detail:e()})}#as(){const e=this.$props.crossOrigin()??this.$props.crossorigin(),t=!0===e?"":e;this.$state.crossOrigin.set(t)}#rs(){const{duration:e}=this.$props;this.dispatch("media-duration-change-request",{detail:e()})}#cs(){const e=this.$props.playsInline()||this.$props.playsinline();this.$state.playsInline.set(e),this.dispatch("plays-inline-change",{detail:e})}#ss(){const{clipStartTime:e}=this.$props;this.dispatch("media-clip-start-change-request",{detail:e()})}#is(){const{clipEndTime:e}=this.$props;this.dispatch("media-clip-end-change-request",{detail:e()})}#ns(){this.dispatch("live-change",{detail:this.$state.live()})}#ds(){this.$state.liveEdgeTolerance.set(this.$props.liveEdgeTolerance()),this.$state.minLiveDVRWindow.set(this.$props.minLiveDVRWindow())}#os(){this.dispatch("live-edge-change",{detail:this.$state.liveEdge()})}}const oe=["play","pause","seekforward","seekbackward","seekto"];class de extends O{onConnect(){(0,i.QZ)(this.#ms.bind(this)),(0,i.QZ)(this.#ys.bind(this));const e=this.#vs.bind(this);for(const t of oe)navigator.mediaSession.setActionHandler(t,e);(0,i.zp)(this.#T.bind(this))}#T(){for(const e of oe)navigator.mediaSession.setActionHandler(e,null)}#ms(){const{title:e,artist:t,artwork:s,poster:i}=this.$state;navigator.mediaSession.metadata=new MediaMetadata({title:e(),artist:t(),artwork:s()??[{src:i()}]})}#ys(){const{canPlay:e,paused:t}=this.$state;navigator.mediaSession.playbackState=e()?t()?"paused":"playing":"none"}#vs(e){const t=new i.vP("media-session-action",{detail:e});switch(e.action){case"play":this.dispatch("media-play-request",{trigger:t});break;case"pause":this.dispatch("media-pause-request",{trigger:t});break;case"seekto":case"seekforward":case"seekbackward":this.dispatch("media-seek-request",{detail:(0,i.Et)(e.seekTime)?e.seekTime:this.$state.currentTime()+(e.seekOffset??("seekforward"===e.action?10:-10)),trigger:t})}}}class he extends i.uA{static props=H;static state=q;#Z;#Be;#fs;canPlayQueue=new Y;remoteControl;get#ks(){return this.#Z.$provider()}get#ws(){return this.$props}constructor(){super(),new ne;const e={player:this,qualities:new A,audioTracks:new x,storage:null,$provider:(0,i.O)(null),$providerSetup:(0,i.O)(!1),$props:this.$props,$state:this.$state};e.remote=this.remoteControl=new E(void 0),e.remote.setPlayer(this),e.textTracks=new I,e.textTracks[o.Hp.crossOrigin]=this.$state.crossOrigin,e.textRenderers=new L(e),e.ariaKeys={},this.#Z=e,(0,i.Pp)(a.Q2,e),this.orientation=new w,new g.f,new F(e);const t=new ie;this.#Be=new re(t,e),this.#fs=new ee(this.#Be,t,e),e.delegate=new J(this.#Be.handle.bind(this.#Be),e),e.notify=e.delegate.notify.bind(e.delegate),"undefined"!=typeof navigator&&"mediaSession"in navigator&&new de,new _("load",this.startLoading.bind(this)),new _("posterLoad",this.startLoadingPoster.bind(this))}onSetup(){this.#bs(),(0,i.QZ)(this.#qs.bind(this)),(0,i.QZ)(this.#Ts.bind(this)),(0,i.QZ)(this.#xe.bind(this)),(0,i.QZ)(this.#Ps.bind(this)),(0,i.QZ)(this.#$s.bind(this)),(0,i.QZ)(this.#cs.bind(this)),(0,i.QZ)(this.#Es.bind(this))}onAttach(e){e.setAttribute("data-media-player",""),(0,u.jk)(e,"tabindex","0"),(0,u.jk)(e,"role","region"),(0,i.QZ)(this.#Ss.bind(this)),(0,i.QZ)(this.#ps.bind(this)),(0,i.QZ)(this.#Cs.bind(this)),(0,i.k6)(e,"find-media-player",this.#Ls.bind(this))}onConnect(e){r.dh&&(0,i.Bq)(e,"data-iphone","");const t=window.matchMedia("(pointer: coarse)");this.#Is(t),t.onchange=this.#Is.bind(this);const s=new ResizeObserver((0,i.s_)(this.#Ms.bind(this)));s.observe(e),(0,i.QZ)(this.#Ms.bind(this)),this.dispatch("media-player-connect",{detail:this,bubbles:!0,composed:!0}),(0,i.zp)((()=>{s.disconnect(),t.onchange=null}))}onDestroy(){this.#Z.player=null,this.canPlayQueue.reset()}#Rs=!1;#ps(){const e=this.$el,{title:t,live:s,viewType:a,providedTitle:r}=this.$state,n=s(),o=(0,i.Fb)(a()),d="Unknown"!==o?`${n?"Live ":""}${o}`:n?"Live":"Media",h=t();(0,i.Bq)(this.el,"aria-label",`${d} Player`+(h?` - ${h}`:"")),e?.hasAttribute("title")&&(this.#Rs=!0,e?.removeAttribute("title"))}#Cs(){const e=this.orientation.landscape?"landscape":"portrait";this.$state.orientation.set(e),(0,i.Bq)(this.el,"data-orientation",e),this.#Ms()}#qs(){this.$state.canPlay()&&this.#ks?this.canPlayQueue.start():this.canPlayQueue.stop()}#bs(){if(he[U])return void this.setAttributes(he[U]);const e={"data-load":function(){return this.$props.load()},"data-captions":function(){const e=this.$state.textTrack();return!!e&&(0,o._k)(e)},"data-ios-controls":function(){return this.$state.iOSControls()},"data-controls":function(){return this.controls.showing},"data-buffering":function(){const{canLoad:e,canPlay:t,waiting:s}=this.$state;return e()&&(!t()||s())},"data-error":function(){const{error:e}=this.$state;return!!e()},"data-autoplay-error":function(){const{autoPlayError:e}=this.$state;return!!e()}},t={autoPlay:"autoplay",canAirPlay:"can-airplay",canPictureInPicture:"can-pip",pictureInPicture:"pip",playsInline:"playsinline",remotePlaybackState:"remote-state",remotePlaybackType:"remote-type",isAirPlayConnected:"airplay",isGoogleCastConnected:"google-cast"};for(const s of B)e["data-"+(t[s]??(0,i.BW)(s))]=function(){return this.$state[s]()};delete e.title,he[U]=e,this.setAttributes(e)}#Ls(e){e.detail(this)}#Ms(){if(!this.el)return;const e=this.el.clientWidth,t=this.el.clientHeight;this.$state.width.set(e),this.$state.height.set(t),(0,i.eC)(this.el,"--player-width",e+"px"),(0,i.eC)(this.el,"--player-height",t+"px")}#Is(e){const t=e.matches?"coarse":"fine";(0,i.Bq)(this.el,"data-pointer",t),this.$state.pointer.set(t),this.#Ms()}get provider(){return this.#ks}get controls(){return this.#fs.controls}set controls(e){this.#ws.controls.set(e)}orientation;get title(){return(0,i.se)(this.$state.title)}set title(e){this.#Rs?this.#Rs=!1:this.#ws.title.set(e)}get qualities(){return this.#Z.qualities}get audioTracks(){return this.#Z.audioTracks}get textTracks(){return this.#Z.textTracks}get textRenderers(){return this.#Z.textRenderers}get duration(){return this.$state.duration()}set duration(e){this.#ws.duration.set(e)}get paused(){return(0,i.se)(this.$state.paused)}set paused(e){this.#xs(e)}#xe(){this.#xs(this.$props.paused())}#xs(e){e?this.canPlayQueue.enqueue("paused",(()=>this.#fs.pause())):this.canPlayQueue.enqueue("paused",(()=>this.#fs.play()))}get muted(){return(0,i.se)(this.$state.muted)}set muted(e){this.#As(e)}#Ts(){this.#As(this.$props.muted())}#As(e){this.canPlayQueue.enqueue("muted",(()=>{this.#ks&&this.#ks.setMuted(e)}))}get currentTime(){return(0,i.se)(this.$state.currentTime)}set currentTime(e){this.#Os(e)}#$s(){this.#Os(this.$props.currentTime())}#Os(e){this.canPlayQueue.enqueue("currentTime",(()=>{const{currentTime:t,clipStartTime:s,seekableStart:a,seekableEnd:r}=this.$state;e!==(0,i.se)(t)&&(0,i.se)((()=>{if(!this.#ks)return;const t=e+s(),i=Math.floor(e)===Math.floor(a()),n=Math.floor(t)===Math.floor(r()),o=i?a():n?r():Math.min(Math.max(a()+.1,t),r()-.1);Number.isFinite(o)&&this.#ks.setCurrentTime(o)}))}))}get volume(){return(0,i.se)(this.$state.volume)}set volume(e){this.#Qs(e)}#Ps(){this.#Qs(this.$props.volume())}#Qs(e){const t=(0,p.N)(0,e,1);this.canPlayQueue.enqueue("volume",(()=>{this.#ks&&this.#ks.setVolume(t)}))}get playbackRate(){return(0,i.se)(this.$state.playbackRate)}set playbackRate(e){this.#Ds(e)}#Es(){this.#Ds(this.$props.playbackRate())}#Ds(e){this.canPlayQueue.enqueue("rate",(()=>{this.#ks&&this.#ks.setPlaybackRate?.(e)}))}#cs(){this.#Fs(this.$props.playsInline())}#Fs(e){this.canPlayQueue.enqueue("playsinline",(()=>{this.#ks&&this.#ks.setPlaysInline?.(e)}))}#Ss(){let e=this.$props.storage(),t=(0,i.Kg)(e)?new S:e;if(t?.onChange){const{source:s}=this.$state,a=(0,i.Kg)(e)?e:this.el?.id,r=(0,i.EW)(this.#Vs.bind(this));(0,i.QZ)((()=>t.onChange(s(),r(),a||void 0)))}this.#Z.storage=t,this.#Z.textTracks.setStorage(t),(0,i.zp)((()=>{t?.onDestroy?.(),this.#Z.storage=null,this.#Z.textTracks.setStorage(null)}))}#Vs(){const{clipStartTime:e,clipEndTime:t}=this.$props,{source:s}=this.$state,i=s();return i.src?`${i.src}:${e()}:${t()}`:null}async play(e){return this.#fs.play(e)}async pause(e){return this.#fs.pause(e)}async enterFullscreen(e,t){return this.#fs.enterFullscreen(e,t)}async exitFullscreen(e,t){return this.#fs.exitFullscreen(e,t)}enterPictureInPicture(e){return this.#fs.enterPictureInPicture(e)}exitPictureInPicture(e){return this.#fs.exitPictureInPicture(e)}seekToLiveEdge(e){this.#fs.seekToLiveEdge(e)}startLoading(e){this.#Z.notify("can-load",void 0,e)}startLoadingPoster(e){this.#Z.notify("can-load-poster",void 0,e)}requestAirPlay(e){return this.#fs.requestAirPlay(e)}requestGoogleCast(e){return this.#fs.requestGoogleCast(e)}setAudioGain(e,t){return this.#fs.setAudioGain(e,t)}destroy(){super.destroy(),this.#Z.remote.setPlayer(null),this.dispatch("destroy")}}const ce=he.prototype;function le(e,t){return fetch(e,t).then((e=>e.text())).then((s=>{const i=function(e){const t=e.match(/#EXT-X-STREAM-INF:[^\n]+(\n[^\n]+)*/g);return t?t[0].split("\n")[1].trim():null}(s);if(i)return le(/^https?:/.test(i)?i:new URL(i,e).href,t);const a=/EXT-X-PLAYLIST-TYPE:\s*VOD/.test(s)?"on-demand":"live";return"live"===a&&function(e){const t=e.split("\n");for(const e of t)if(e.startsWith("#EXT-X-TARGETDURATION")){const t=parseFloat(e.split(":")[1]);if(!isNaN(t))return t}return-1}(s)>=10&&(/#EXT-X-DVR-ENABLED:\s*true/.test(s)||s.includes("#EXT-X-DISCONTINUITY"))?"live:dvr":a}))}(0,i._w)(ce,"canPlayQueue"),(0,i._w)(ce,"remoteControl"),(0,i._w)(ce,"provider"),(0,i._w)(ce,"controls"),(0,i._w)(ce,"orientation"),(0,i._w)(ce,"title"),(0,i._w)(ce,"qualities"),(0,i._w)(ce,"audioTracks"),(0,i._w)(ce,"textTracks"),(0,i._w)(ce,"textRenderers"),(0,i._w)(ce,"duration"),(0,i._w)(ce,"paused"),(0,i._w)(ce,"muted"),(0,i._w)(ce,"currentTime"),(0,i._w)(ce,"volume"),(0,i._w)(ce,"playbackRate"),(0,i.EJ)(ce,"play"),(0,i.EJ)(ce,"pause"),(0,i.EJ)(ce,"enterFullscreen"),(0,i.EJ)(ce,"exitFullscreen"),(0,i.EJ)(ce,"enterPictureInPicture"),(0,i.EJ)(ce,"exitPictureInPicture"),(0,i.EJ)(ce,"seekToLiveEdge"),(0,i.EJ)(ce,"startLoading"),(0,i.EJ)(ce,"startLoadingPoster"),(0,i.EJ)(ce,"requestAirPlay"),(0,i.EJ)(ce,"requestGoogleCast"),(0,i.EJ)(ce,"setAudioGain");const ue=new Map;class pe{#js=!1;#zs;#Ks;#Z;#Ns;constructor(e,t,s,a=[]){this.#Ks=e,this.#Z=t,this.#Ns=s;const r=new W,n=new N,o=new K,d=new z,h=[new Z,new G];this.#zs=(0,i.EW)((()=>{const e=t.$state.remotePlaybackLoader(),s=t.$props.preferNativeHLS()?[o,d,r,n,...h,...a]:[n,o,d,r,...h,...a];return e?[e,...s]:s}));const{$state:c}=t;c.sources.set(ge(t.$props.src()));for(const e of c.sources()){const s=this.#zs().find((t=>t.canPlay(e)));if(!s)continue;const i=s.mediaType(e);t.$state.source.set(e),t.$state.mediaType.set(i),t.$state.inferredViewType.set(i),this.#Ns.set(s),this.#js=!0;break}}connect(){const e=this.#Ns();this.#js&&(this.#Ws(this.#Z.$state.source(),e),this.#Gs(e),this.#js=!1),(0,i.QZ)(this.#Zs.bind(this)),(0,i.QZ)(this.#Us.bind(this)),(0,i.QZ)(this.#Bs.bind(this)),(0,i.QZ)(this.#Hs.bind(this)),(0,i.QZ)(this.#_s.bind(this))}#Zs(){this.#Z.notify("sources-change",[...ge(this.#Z.$props.src()),...this.#Ks()])}#Us(){const{$state:e}=this.#Z,t=e.sources(),s=(0,i.se)(e.source),a=this.#Js(s,t);if(t[0]?.src&&!a.src&&!a.type){const{crossOrigin:s}=e,a=(0,l.WF)(s()),r=new AbortController;return Promise.all(t.map((e=>(0,i.Kg)(e.src)&&"?"===e.type?fetch(e.src,{method:"HEAD",credentials:a,signal:r.signal}).then((t=>(e.type=t.headers.get("content-type")||"??",ue.set(e.src,e.type),e))).catch((()=>e)):e))).then((t=>{if(r.signal.aborted)return;const s=this.#Js((0,i.se)(e.source),t);(0,i.io)(),s.src||this.#Z.notify("error",{message:"Failed to load resource.",code:4})})),()=>r.abort()}(0,i.io)()}#Js(e,t){let s={src:"",type:""},a=null,r=new i.vP("sources-change",{detail:{sources:t}}),n=this.#zs(),{started:o,paused:d,currentTime:h,quality:c,savedState:l}=this.#Z.$state;for(const e of t){const t=n.find((t=>t.canPlay(e)));if(t){s=e,a=t;break}}if(b(s)){const e=c(),a=t.find((t=>t.src===e?.src));(0,i.se)(o)?l.set({paused:(0,i.se)(d),currentTime:(0,i.se)(h)}):l.set(null),a&&(s=a,r=new i.vP("quality-change",{detail:{quality:e}}))}return ye(e,s)||this.#Ws(s,a,r),a!==(0,i.se)(this.#Ns)&&this.#Gs(a,r),s}#Ws(e,t,s){this.#Z.notify("source-change",e,s),this.#Z.notify("media-type-change",t?.mediaType(e)||"unknown",s)}#Gs(e,t){this.#Z.$providerSetup.set(!1),this.#Z.notify("provider-change",null,t),e&&(0,i.se)((()=>e.preconnect?.(this.#Z))),this.#Ns.set(e),this.#Z.notify("provider-loader-change",e,t)}#Bs(){const e=this.#Z.$provider();if(e&&!(0,i.se)(this.#Z.$providerSetup))return this.#Z.$state.canLoad()?((0,i.P1)((()=>e.setup()),e.scope),void this.#Z.$providerSetup.set(!0)):void(0,i.se)((()=>e.preconnect?.()))}#Hs(){if(!this.#Z.$providerSetup())return;const e=this.#Z.$provider(),t=this.#Z.$state.source(),s=(0,i.se)(this.#Z.$state.crossOrigin),a=(0,i.se)(this.#Z.$props.preferNativeHLS);if(!ye(e?.currentSrc,t)){if(this.#Z.$state.canLoad()){const d=new AbortController;return(0,r.YJ)(t)?!a&&(0,r.m0)()||le(t.src,{credentials:(0,l.WF)(s),signal:d.signal}).then((e=>{this.#Z.notify("stream-type-change",e)})).catch(i.lQ):(0,r.Pl)(t)?(n=t.src,o={credentials:(0,l.WF)(s),signal:d.signal},fetch(n,o).then((e=>e.text())).then((e=>/type="static"/.test(e)?"on-demand":"live"))).then((e=>{this.#Z.notify("stream-type-change",e)})).catch(i.lQ):this.#Z.notify("stream-type-change","on-demand"),(0,i.se)((()=>{const s=(0,i.se)(this.#Z.$state.preload);return e?.loadSource(t,s).catch((e=>{}))})),()=>d.abort()}var n,o;try{(0,i.Kg)(t.src)&&(0,l.kZ)(new URL(t.src).origin)}catch(e){}}}#_s(){const e=this.#Ns(),{providedPoster:t,source:s,canLoadPoster:a}=this.#Z.$state;if(!e||!e.loadPoster||!s()||!a()||t())return;const r=new AbortController,n=new i.vP("source-change",{detail:s});return e.loadPoster(s(),this.#Z,r).then((e=>{this.#Z.notify("poster-change",e||"",n)})).catch((()=>{this.#Z.notify("poster-change","",n)})),()=>{r.abort()}}}function ge(e){return((0,i.cy)(e)?e:[e]).map((e=>(0,i.Kg)(e)?{src:e,type:me(e)}:{...e,type:me(e.src,e.type)}))}function me(e,t){return(0,i.Kg)(t)&&t.length?t:(0,i.Kg)(e)&&ue.has(e)?ue.get(e):!t&&(0,r.YJ)({src:e,type:""})?"application/x-mpegurl":!t&&(0,r.Pl)({src:e,type:""})?"application/dash+xml":!(0,i.Kg)(e)||e.startsWith("blob:")?"video/object":e.includes("youtube")||e.includes("youtu.be")?"video/youtube":!e.includes("vimeo")||e.includes("progressive_redirect")||e.includes(".m3u8")?"?":"video/vimeo"}function ye(e,t){return e?.src===t?.src&&e?.type===t?.type}class ve{#Xs;#Z;#Ys=[];constructor(e,t){this.#Xs=e,this.#Z=t,(0,i.QZ)(this.#ei.bind(this))}#ei(){const e=this.#Xs();for(const t of this.#Ys)if(!e.some((e=>e.id===t.id))){const e=t.id&&this.#Z.textTracks.getById(t.id);e&&this.#Z.textTracks.remove(e)}for(const t of e){const e=t.id||o.to.createId(t);this.#Z.textTracks.getById(e)||(t.id=e,this.#Z.textTracks.add(t))}this.#Ys=e}}class fe extends i.uA{static props={loaders:[]};static state=new i.Uw({loader:null});#Z;#ti;#Ks=(0,i.O)([]);#Xs=(0,i.O)([]);#Ns=null;onSetup(){this.#Z=(0,a.$c)(),this.#ti=new pe(this.#Ks,this.#Z,this.$state.loader,this.$props.loaders())}onAttach(e){e.setAttribute("data-media-provider","")}onConnect(e){this.#ti.connect(),new ve(this.#Xs,this.#Z);const t=new ResizeObserver((0,i.s_)(this.#Ms.bind(this)));t.observe(e);const s=new MutationObserver(this.#si.bind(this));s.observe(e,{attributes:!0,childList:!0}),this.#Ms(),this.#si(),(0,i.zp)((()=>{t.disconnect(),s.disconnect()}))}#ii=-1;load(e){e?.setAttribute("aria-hidden","true"),window.cancelAnimationFrame(this.#ii),this.#ii=requestAnimationFrame((()=>this.#ai(e))),(0,i.zp)((()=>{window.cancelAnimationFrame(this.#ii)}))}#ai(e){if(!this.scope)return;const t=this.$state.loader(),{$provider:s}=this.#Z;this.#Ns===t&&t?.target===e&&(0,i.se)(s)||(this.#ri(),this.#Ns=t,t&&(t.target=e||null),t&&e&&t.load(this.#Z).then((e=>{this.scope&&(0,i.se)(this.$state.loader)===t&&this.#Z.notify("provider-change",e)})))}onDestroy(){this.#Ns=null,this.#ri()}#ri(){this.#Z?.notify("provider-change",null)}#Ms(){if(!this.el)return;const{player:e,$state:t}=this.#Z,s=this.el.offsetWidth,a=this.el.offsetHeight;e&&(t.mediaWidth.set(s),t.mediaHeight.set(a),e.el&&((0,i.eC)(e.el,"--media-width",s+"px"),(0,i.eC)(e.el,"--media-height",a+"px")))}#si(){const e=[],t=[],s=this.el.children;for(const a of s)if(!a.hasAttribute("data-vds"))if(a instanceof HTMLSourceElement){const t={id:a.id,src:a.src,type:a.type};for(const e of["id","src","width","height","bitrate","codec"]){const s=a.getAttribute(`data-${e}`);(0,i.Kg)(s)&&(t[e]=/id|src|codec/.test(e)?s:Number(s))}e.push(t)}else if(a instanceof HTMLTrackElement){const e={src:a.src,kind:a.track.kind,language:a.srclang,label:a.label,default:a.default,type:a.getAttribute("data-type")};t.push({id:a.id||o.to.createId(e),...e})}this.#Ks.set(e),this.#Xs.set(t),(0,i.io)()}}const ke=fe.prototype;(0,i.EJ)(ke,"load");class we extends((0,i.xr)(HTMLElement,fe)){static tagName="media-provider";#Z;#I=null;#ni=null;onSetup(){this.#Z=(0,a.$c)(),this.setAttribute("keep-alive","")}onDestroy(){this.#ni?.remove(),this.#ni=null,this.#I?.remove(),this.#I=null}onConnect(){(0,i.QZ)((()=>{const e=this.$state.loader(),t="youtube"===e?.name,s="vimeo"===e?.name,a=t||s,r=e?"google-cast"===e?.name?this.#oi():a?this.#di():"audio"===e.mediaType()?this.#hi():this.#ci():null;if(this.#I!==r){const e=this.#I?.parentElement??this;this.#I?.remove(),this.#I=r,r&&e.prepend(r),a&&r&&(0,i.QZ)((()=>{const{nativeControls:e,viewType:t}=this.#Z.$state,s=e(),a="audio"===t();s||a?(this.#ni?.remove(),this.#ni=null):(this.#ni=this.querySelector(".vds-blocker"),this.#ni||(this.#ni=document.createElement("div"),this.#ni.classList.add("vds-blocker"),r.after(this.#ni))),(0,i.Bq)(r,"data-no-controls",!s)}))}t?r?.classList.add("vds-youtube"):s&&r?.classList.add("vds-vimeo"),a||(this.#ni?.remove(),this.#ni=null),this.load(r)}))}#hi(){const e=this.#I instanceof HTMLAudioElement?this.#I:document.createElement("audio"),{controls:t,crossOrigin:s}=this.#Z.$state;return(0,i.QZ)((()=>{(0,i.Bq)(e,"controls",t()),(0,i.Bq)(e,"crossorigin",s())})),e}#ci(){const e=this.#I instanceof HTMLVideoElement?this.#I:document.createElement("video"),{crossOrigin:t,poster:s,nativeControls:a}=this.#Z.$state,r=(0,i.EW)((()=>a()?"true":null)),n=(0,i.EW)((()=>s()&&a()?s():null));return(0,i.QZ)((()=>{(0,i.Bq)(e,"controls",r()),(0,i.Bq)(e,"crossorigin",t()),(0,i.Bq)(e,"poster",n())})),e}#di(){const e=this.#I instanceof HTMLIFrameElement?this.#I:document.createElement("iframe"),{nativeControls:t}=this.#Z.$state;return(0,i.QZ)((()=>(0,i.Bq)(e,"tabindex",t()?null:-1))),e}#oi(){if(this.#I?.classList.contains("vds-google-cast"))return this.#I;const e=document.createElement("div");return e.classList.add("vds-google-cast"),s.e(926).then(s.bind(s,9926)).then((({insertContent:t})=>{t(e,this.#Z.$state)})),e}}class be extends((0,i.xr)(HTMLElement,he)){static tagName="media-player";static attrs={autoPlay:"autoplay",crossOrigin:"crossorigin",playsInline:"playsinline",preferNativeHLS:"prefer-native-hls",minLiveDVRWindow:"min-live-dvr-window"}}(0,i.Xq)(be),(0,i.Xq)(we)}}]);